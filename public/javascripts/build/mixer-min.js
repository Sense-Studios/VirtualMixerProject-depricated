function AudioAnalysis(e){this.uuid="Analysis_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),this.type="Addon",this.audio="",this.bypass=!1;e.add(this),this.init=function(){console.log("init Audio Analysis Addon.")},this.update=function(){},this.scheme=function(){}}function BPM(e){var n=this;n.uuid="BPM_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),n.type="Addon",n.bpm=128,n.bps=2.133333,n.sec=0,n.bpm_float=.46875,n.mod=1,n.useAutoBpm=!0,n.autoBpmData={},n.useMicrophone=!1,n.audio_src="",n.bypass=!1;var t=[],r=0;e.add(n),n.scheme=function(){return{description:{name:"BPM",type:"Addon"},inputs:{bypass:"Boolean",audio:"Addon",mod:"number"},outputs:{bpm:"number",bpm_float:"float"}}},n.init=function(){console.log("init BPM contoller."),x()};var o=(new Date).getTime();n.update=function(){t.forEach(function(e){e(n.render())}),r=((new Date).getTime()-o)/1e3,n.sec=r*Math.PI*n.bpm/60,n.bpm_float=(Math.sin(n.sec)+1)/2},n.modUp=function(){n.mod*=2},n.modDown=function(){n.mod*=.5},n.add=function(e){t.push(e)},n.render=function(){return n.bpm_float};var i=Number(new Date),u=[128,128,128,128,128],a=0,c=0;n.tap=function(){useAutoBPM=!1,a=Number(new Date)-i,i=Number(new Date),a<1e4&&a>10&&(u.splice(0,1),u.push(6e4/a),c=u.reduce(function(e,n){return e+n})/u.length,n.bpm=c,n.bps=c/60)};var s,d=new Audio,m=new AudioContext,l=m.createMediaElementSource(d),f=m.createBiquadFilter(),p=m.createAnalyser(),h=Date.now(),g=new Array(4e3),v=new Array(4e3),_=[],S=1,y=[];console.log("SET AUDIO SRC"),d.src="/audio/fear_is_the_mind_killer_audio.mp3",d.controls=!0,d.loop=!0,d.autoplay=!0,f.type="lowpass",f.frequency.value=350,f.Q.value=1,p.fftSize=128,s=p.frequencyBinCount,$("body").click(function(){console.log("Auto BPM is initialized!",d.src),d.play(),document.body.webkitRequestFullScreen()});var b=new Promise(function(e,n){l.connect(f),f.connect(p),e(d),n(err)}),x=function(){b.then(function(e){console.log("Auto BPM is initialized!",d.src),d.play(),setInterval(w,1)}).catch(function(e){console.log("Error: Auto BPM ERROR ",e)})},w=function(){if(n.useAutoBpm&&(""==n.audio_src||n.useMicrophone)&&!n.bypass){var e=new Uint8Array(s);p.getByteTimeDomainData(e);var t=Date.now(),o=0;if(e.forEach((e,n)=>{e>o&&(o=e)}),g.push([t,o]),g.length>4e3&&g.splice(0,g.length-4e3),0,t-h>100){var i=E(g);window.bpm_test=i.bpm,n.sec=r*Math.PI*i.bpm/60,h=Date.now(),0}}},M=function(){d.paused?$(".blink").hide():$(".blink").toggle(),setTimeout(M,60/window.bpm_test*1e3)};M();var E=function(e){_=[],v=new Array(e.length);for(var n=0;n<e.length;n++)void 0!==e[n]&&e[n][1]>128*S&&(v[n]=[g[n][0],1],_.push([e[n][0],1]),n+=50);_.length<15&&(S-=.05),_.length>60&&(S+=.05),S>2&&(S=2),S<1&&(S=1);var t=A(z(_));if(t.sort(T),0==t.length)t[0]={tempo:0};else{var r="";t.reverse().forEach(function(e,n){r+=n+", "+e.tempo+", "+e.count+"\t [";for(var t=0;t<e.count;)r+="#",t++;r+="]<br/>"}),$("#info").html(r)}var o="calibrating",i=!1;if(void 0===e[0])i=!0,$(".blink").css("background-color","rgba(150,150,150,0.5) !important");else{if(i=!1,void 0===t[0]||void 0===t[1])return void console.log("holdit");var u=t[0].count-t[1].count;u<=2?(o="low",$(".blink").css("background-color","red")):u>2&&u<=7?(o="average",$(".blink").css("background-color","yellow")):u>7&&(o="high",$(".blink").css("background-color","white"))}return{bpm:t[0].tempo,confidence:o,calibrating:i,treshold:S,tempoCounts:t,foundpeaks:_,peaks:v}},T=function(e,n){return parseInt(e.count,10)-parseInt(n.count,10)},z=function(e){return y=[],e.forEach(function(n,t){for(var r=0;r<10;r++)if(void 0!==e[t+r]){var o=e[t+r][0]-n[0];y.some(function(e){if(e.interval===o)return e.count++})||y.push({interval:o,count:1})}}),y},A=function(e){var n=[];return e.forEach(function(e,t){if(0!=e.interval&&!isNaN(e.interval))var r=60/(e.interval/1e3);for(;r<90;)r*=2;for(;r>180;)r/=2;r=2*Math.round(r/2),n.some(function(n){if(n.tempo===r)return n.count+=e.count})||r&&n.push({tempo:r,count:e.count})}),n}}function FileManager(e){var n=this;n.uuid="Filemanager_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),n.type="AddOn",n.defaultQuality="",n.source=e,n.programs=[],n.file,n.renderer=renderer,n.setSrc=function(e){console.log("set source: ",e),n.source.src(e)},n.getFileById=function(e){},n.getSrcByTags=function(e){if(0==programs.length)return"no programs";var t=[];if(programs.forEach(function(n,r){e.forEach(function(e,r){n.tags.includes(e)&&t.push(n)})}),0==t.length)return"no matches";var r=t[Math.floor(Math.random()*t.length)];console.log(">> ",t.length,r.title),n.setSrc(n.getSrcByQuality(r))},n.change=function(e){if(0==programs.length)return"no programs";if(e)n.getSrcByTags([e]);else{console.log("change video");var t=programs[Math.floor(Math.random()*programs.length)];"Video"==t.assets._type?n.setSrc(n.getSrcByQuality(t)):n.change()}},n.changez=function(e){n.change(e)},n.getSrcByQuality=function(e,n){null==n&&(n="720p_h264");var t=null;return e.assets.versions.forEach(function(e){e.label==n&&(t=e)}),t.url}}function GiphyManager(e){var n=this;n.uuid="GiphyManager_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),n.type="AddOn",n.source=e,n.file,n.programs,n.program,n.renderer=renderer;n.needle=function(e){$.get("http://api.giphy.com/v1/gifs/search?api_key=tIovPHdiZhUF3w0UC6ETdEzjYOaFZQFu&q="+e,function(e){n.programs=e.data,console.log(" === GIPHY (re)LOADED === ")})},n.search=function(e){n.needle(e)},n.setSrc=function(e){console.log("set source: ",e),n.source.src(e)},n.change=function(){if(0==n.programs.length)return"no programs";n.program=n.programs[Math.floor(Math.random()*n.programs.length)],n.setSrc(n.program.images.original.url)},n.changez=function(){n.change()},n.needle("vj")}function FireBaseControl(e,n,t,r){this.uuid="FireBaseControl_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),this.type="Control",this.clients={},this.bypass=!0;var o,i,u=[],a=[];e.add(this);var c=0,s=0;this.init=function(){console.log("init FireBase contoller.");var e;firebase.initializeApp({apiKey:"AIzaSyDgrYfOUDN1QLRDcY4z45WwkcOjkXiImNQ",authDomain:"mixerbase-829c2.firebaseapp.com",databaseURL:"https://mixerbase-829c2.firebaseio.com",storageBucket:"mixerbase-829c2.appspot.com",messagingSenderId:"568387460963"}),o=firebase.database(),"/client_1/",i=o.ref("/client_1/"),[],i.on("value",function(e){}),i.child("gamepad/leftx").on("value",function(e){c=e.val(),d(c,s)}),i.child("gamepad/lefty").on("value",function(e){s=e.val(),d(c,s)}),i.child("gamepad/button_1").on("value",function(n){clearTimeout(e),e=setTimeout(function(){giphymanager1.change()},200)}),i.child("gamepad/button_2").on("value",function(n){clearTimeout(e),e=setTimeout(function(){filemanager2.change()},200)}),i.child("gamepad/button_3").on("value",function(n){clearTimeout(e),e=setTimeout(function(){filemanager3.change()},200)}),i.child("gamepad/button_4").on("value",function(n){clearTimeout(e),e=setTimeout(function(){filemanager4.change()},200)});for(var n=0;n<17;)i.child("mobilepad/button_"+n).on("value",function(e){console.log("i click you",n,e.key)}),n++},this.update=function(){},this.render=function(){},this.addMixer=function(e){u.push(e)},this.addFileManager=function(e){a.push(e)};var d=function(e,o){console.log("update mixers"),n.pod(e/2+.5),t.pod(e/2+.5),r.pod(o/2+.5)}}function GamePad(e,n,t,r){var o=this;o.uuid="GamePad_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),o.type="Control",o.controllers={},o.bypass=!0;var i,u,a,c,s=[];e.add(o),o.init=function(){console.log("init GamepadController contoller."),window.addEventListener("gamepadconnected",d)},o.update=function(){if(!o.bypass){navigator.getGamepads()[0].buttons;navigator.getGamepads()[0].buttons.forEach(function(e,n){e.pressed&&(console.log(" i press you ",n,e),0==n&&(clearTimeout(i),i=setTimeout(function(){filemanager1.change()},200)),1==n&&(clearTimeout(u),u=setTimeout(function(){filemanager2.change()},200)),2==n&&(clearTimeout(a),a=setTimeout(function(){filemanager3.change()},200)),3==n&&(clearTimeout(c),c=setTimeout(function(){filemanager4.change()},200)))});var e=navigator.getGamepads()[0].axes,s=e[0],d=e[1];e[5],e[6],e[9];n.pod(s/2+.5),t.pod(s/2+.5),r.pod(d/2+.5)}},o.add=function(e){s.push(e)},o.render=function(){return o.controllers};var d=function(e){var n;console.log("Gamepad connected at index %d: %s. %d buttons, %d axes.",e.gamepad.index,e.gamepad.id),n=e.gamepad,o.controllers[n.index]=n,console.log(n.id,n.index),o.bypass=!1}}function GamePadHorizontalControl(e){}function GamePadVerticalControl(e){}function MidiController(e,n,t,r){this.uuid="Midi_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),this.type="Control",this.controllers={},this.bypass=!0;e.add(this),this.init=function(){console.log("init MidiController contoller.")},this.update=function(){},this.scheme=function(){return{inputs:{},outputs:{tones:[],floats:[],visual:[],audio:[]}}}}function NumpadBpmMixerControl(e,n,t){this.uuid="NumpadBpmMixer_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),this.type="Control",this.controllers={};var r=[],o=[];e.add(this),this.init=function(){window.addEventListener("keydown",c),window.addEventListener("keyup",s)},this.update=function(){},this.render=function(){},this.addMixer=function(e){o.push(e)},this.addBpm=function(e){r.push(e)};var i,u=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18],a=[1,2,3,4,5,6,7,8,9];$("body").click(function(){r.forEach(function(e){e.tap()})});var c=function(e){console.log("had key: ",e.which),[[109,function(){r.forEach(function(e){e.bpm-=1})}],[107,function(){r.forEach(function(e){e.bpm+=1})}],[106,function(){r.forEach(function(e){e.bpm*=2})}],[111,function(){r.forEach(function(e){e.bpm*=.5})}],[101,function(){r.forEach(function(e){e.tap()})}],[96,function(){switcher1.doSwitch(0)}],[110,function(){switcher1.doSwitch(1)}],[75,function(){switcher1.doSwitch(0)}],[76,function(){switcher1.doSwitch(1)}],[66,function(){r.forEach(function(e){e.tap()})}],[32,function(){r.forEach(function(e){e.tap()})}],[81,function(){clearTimeout(i),i=setTimeout(function(){giphymanager1.change()},200)}],[87,function(){clearTimeout(i),i=setTimeout(function(){filemanager2.change("awesome")},200)}],[69,function(){clearTimeout(i),i=setTimeout(function(){filemanager3.change("runner")},200)}],[82,function(){clearTimeout(i),i=setTimeout(function(){filemanager4.change()},200)}],[65,function(){giphymanager1.source.currentFrame(Math.floor(Math.random()*giphymanager1.source.duration()))}],[83,function(){filemanager2.source.currentTime(Math.floor(Math.random()*filemanager2.source.duration()))}],[68,function(){filemanager3.source.currentTime(Math.floor(Math.random()*filemanager3.source.duration()))}],[188,function(){mixer3.pod(mixer3.pod()-.1)}],[190,function(){mixer3.pod(mixer3.pod()+.1)}],[104,function(){o.forEach(function(e){e.blendMode(1),e.mixMode(1),u=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18],a=[1,2,3,4,5,6,7,8,9]})}],[103,function(){u.unshift(u.pop()),o.forEach(function(e){e.blendMode(u[0])})}],[105,function(){u.push(u.shift()),o.forEach(function(e){e.blendMode(u[0])})}],[100,function(){a.unshift(a.pop()),o.forEach(function(e){e.mixMode(a[0])})}],[102,function(){a.push(a.shift()),o.forEach(function(e){e.mixMode(a[0])})}],[97,function(){console.log("mix trans left, down")}],[99,function(){console.log("mmix trans right, down")}]].forEach(function(r){r[0]==e.which&&(r[1](),console.log("numpad Handled key DOWN",r[0],t.bpm,n.mixMode(),n.blendMode()))})},s=function(e){[[97,function(){console.log("mix trans left, up")}],[99,function(){console.log("mmix trans right, up")}]].forEach(function(r){r[0]==e.which&&(r[1](),console.log("numpad Handled key UP",r[0],t.bpm,n.mixMode(),n.blendMode()))})}}function SourceControl(e,n){}function BlackAndWhite(e,n){var t=this;null==options.uuid?t.uuid="Effect_BlackAndWhite_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):t.uuid=options.uuid,t.type="Effect";t.init=function(){e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform int "+t.uuid+"_mixmode;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_main */","vec3 "+t.uuid+"_output = blend( "+source1.uuid+"_output ,"+source2.uuid+"_output, "+t.uuid+"_blendmode );\n  /* custom_main */")},t.update=function(){}}var GlRenderer=function(){console.log("created renderer");var e=this;e.glrenderer=new THREE.WebGLRenderer({canvas:glcanvas,alpha:!1}),e.scene=new THREE.Scene,e.camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),e.camera.position.z=20,e.nodes=[],e.customUniforms={},e.customDefines={},e.vertexShader="\nvarying vec2 vUv;\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n  vUv = uv;\n}",e.fragmentShader="\nuniform sampler2D textureTest;\nuniform float wave;\n/* custom_uniforms */\n\n/* custom_helpers */\n\nvarying vec2 vUv;\nvoid main() {\n  /* custom_main */\n\n}",e.init=function(){console.log("init renderer"),e.nodes.forEach(function(e){e.init()}),e.shaderMaterial=new THREE.ShaderMaterial({uniforms:e.customUniforms,defines:e.customDefines,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,side:THREE.DoubleSide,transparent:!0}),e.flatGeometry=new THREE.PlaneGeometry(67,38),e.flatGeometry.translate(0,0,0),e.surface=new THREE.Mesh(e.flatGeometry,e.shaderMaterial),e.scene.add(e.surface)};Math.round(100*Math.random());e.render=function(){requestAnimationFrame(e.render),e.glrenderer.render(e.scene,e.camera),e.glrenderer.setSize(window.innerWidth,window.innerHeight),e.nodes.forEach(function(e){e.update()})},e.add=function(n){e.nodes.push(n)},e.dispose=function(){e.shaderMaterial,e.flatGeometry,e.scene.remove(e.surface),e.glrenderer.resetGLState(),e.customUniforms={},e.customDefines={},e.vertexShader="  \nvarying vec2 vUv;  \nvoid main() {  \n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );  \n  vUv = uv;  \n}",e.fragmentShader="  \nuniform sampler2D textureTest;  \nuniform float wave;  \n/* custom_uniforms */\n  \n/* custom_helpers */\n  \nvarying vec2 vUv;  \nvoid main() {  \n  /* custom_main */\n  \n}",e.nodes=[]}},testSource1=new GifSource(renderer=new GlRenderer,{src:"//nabu-dev.s3.amazonaws.com/uploads/video/556ce4f36465764bdf590000/720p_h264.mp4"}),testSource2=new VideoSource(renderer,{src:"//nabu-dev.s3.amazonaws.com/uploads/video/556ce4f36465764bdf590000/720p_h264.mp4"}),testSource3=new VideoSource(renderer,{src:"//nabu-dev.s3.amazonaws.com/uploads/video/556ce4f36465764bdf590000/720p_h264.mp4"}),testSource4=new VideoSource(renderer,{src:"//nabu-dev.s3.amazonaws.com/uploads/video/556ce4f36465764bdf590000/720p_h264.mp4"}),testSource5=new SolidSource(renderer,{color:{r:.1,g:1,b:.5}}),mixer1=new Mixer(renderer,{source1:testSource1,source2:testSource2}),mixer2=new Mixer(renderer,{source1:testSource3,source2:testSource4}),mixer3=new Mixer(renderer,{source1:mixer1,source2:mixer2}),mixer4=new Mixer(renderer,{source1:testSource1,source2:testSource2}),switcher1=new Switcher(renderer,[mixer3,mixer4]),giphymanager1=new GiphyManager(testSource1),filemanager2=new FileManager(testSource2),filemanager3=new FileManager(testSource3),filemanager4=new FileManager(testSource4);(bpm=new BPM(renderer)).add(mixer4.pod);var output=new Output(renderer,switcher1);(numpad1=new NumpadBpmMixerControl(renderer,mixer1,bpm)).addBpm(bpm),numpad1.addMixer(mixer1),numpad1.addMixer(mixer2),numpad1.addMixer(mixer3),numpad1.addMixer(mixer4);var firebase1=new FireBaseControl(renderer,mixer1,mixer2,mixer3);renderer.init(),renderer.render(),setTimeout(function(){},12e3);var renderer,changez_mod=42e3,jump_mod=7200,scratch_mod=12e3,RenderTree={type:Mixer,src1:{type:Mixer,pod:0,blendmode:1,mix:4,src1:{type:VideoSource,src:""},src2:{type:VideoSource,src:""}},src2:"",pod:{type:BPM,name:"BPM"}},testSource6=(testSource1=new GifSource(renderer=new GlRenderer,{src:"//nabu.sense-studios.com/assets/nabu_themes/sense/slowclap.gif"}),testSource2=new VideoSource(renderer,{src:"/video/1UP_Graffiti_olympic.mp4"}),testSource3=new VideoSource(renderer,{src:"/video/alaro_carnage_the_underground_gif_remix.mp4"}),testSource4=new VideoSource(renderer,{src:"/video/1UP_Graffiti_olympic.mp4"}),testSource5=new SolidSource(renderer,{color:{r:.1,g:1,b:.5}}),new TextSource(renderer,{}));mixer1=new Mixer(renderer,{source1:testSource6,source2:testSource3});(mixer3=new Mixer(renderer,{source1:testSource1,source2:mixer1})).mixMode(3);var bpm;mixer4=new Mixer(renderer,{source1:testSource1,source2:testSource2}),switcher1=new Switcher(renderer,[mixer3,mixer4]),giphymanager1=new GiphyManager(testSource1),filemanager2=new FileManager(testSource2),filemanager3=new FileManager(testSource3),filemanager4=new FileManager(testSource4);(bpm=new BPM(renderer)).add(mixer4.pod),bpm.add(mixer1.pod);var numpad1;output=new Output(renderer,switcher1);(numpad1=new NumpadBpmMixerControl(renderer,mixer1,bpm)).addBpm(bpm),numpad1.addMixer(mixer1),numpad1.addMixer(mixer4),renderer.init(),renderer.render(),setTimeout(function(){console.log("GO GO GO"),switcher1.doSwitch(0),mixer3.pod(0)},3200);changez_mod=32e3,jump_mod=12e3,scratch_mod=64e3;var blend_mod=16e3;function change_blendmode(){var e=blend_mod/bpm.bps;setTimeout(function(){change_blendmode()},e);var n=[1,2,7,8,9,10,11,13,17,18],t=n[Math.floor(Math.random()*n.length)];mixer1.blendMode(t),console.log("BLENDMODE",t)}function change_mixmode(){var e=Math.random()*blend_mod/bpm.bps;setTimeout(function(){change_mixmode()},e);var n=Math.ceil(9*Math.random());mixer1.mixMode(n),console.log("MIXMODE",n)}function jumps(){var e=Math.random()*jump_mod/bpm.bps;setTimeout(function(){jumps()},e);try{Math.random()>.5?(testSource2.video.currentTime=Math.random()*testSource2.video.duration,console.log("src 2 jumps")):(testSource3.video.currentTime=Math.random()*testSource3.video.duration,console.log("src 3 jumps"))}catch(e){}}function scratch(){var e=Math.random()*scratch_mod*bpm.bps;setTimeout(function(){scratch()},e);try{var n=.6*Math.random()+.7;Math.random()>.5?(testSource2.video.playbackRate=n,console.log("src 1 scxratches",n)):(testSource3.video.playbackRate=n,console.log("src 1 scxratches",n))}catch(e){console.log("err:",e)}}function Chain(e,n){var t=this;null==n.uuid?t.uuid="Chain_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):t.uuid=n.uuid,e.add(t),t.type="Module",t.sources=n.sources,t.init=function(){t.sources.forEach(function(n){e.fragmentShader=e.fragmentShader.replace("/* custom_main */","final_output = final_output + vec3( texture2D( "+n.uuid+", vUv ).xyz * "+n.uuid+"_alpha );\n  /* custom_main */")})},t.update=function(){}}function Mixer(e,n){var t=this;null==n.uuid?t.uuid="Mixer_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):t.uuid=n.uuid,e.add(t),t.type="Module";var r,o,i=1,u=0,a=0,c=1,s=1;t.blendmodes=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18],t.mixmodes=[1,2,3,4,5,6,7,8,9],r=n.source1,o=n.source2,t.init=function(){e.customUniforms[t.uuid+"_mixmode"]={type:"i",value:1},e.customUniforms[t.uuid+"_blendmode"]={type:"i",value:1},e.customUniforms[t.uuid+"_alpha1"]={type:"f",value:.5},e.customUniforms[t.uuid+"_alpha2"]={type:"f",value:.5},e.customUniforms[t.uuid+"_sampler"]={type:"t",value:null},e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform int "+t.uuid+"_mixmode;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform int "+t.uuid+"_blendmode;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform float "+t.uuid+"_alpha1;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform float "+t.uuid+"_alpha2;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec4 "+t.uuid+"_output;\n/* custom_uniforms */"),-1==e.fragmentShader.indexOf("vec3 blend ( vec3 src, vec3 dst, int blendmode )")&&(e.fragmentShader=e.fragmentShader.replace("/* custom_helpers */","\nvec3 blend ( vec3 src, vec3 dst, int blendmode ) {\n  if ( blendmode ==  1 ) return src + dst;\n  if ( blendmode ==  2 ) return src - dst;\n  if ( blendmode ==  3 ) return src * dst;\n  if ( blendmode ==  4 ) return min(src, dst);\n  if ( blendmode ==  5)  return vec3((src.x == 0.0) ? 0.0 : (1.0 - ((1.0 - dst.x) / src.x)), (src.y == 0.0) ? 0.0 : (1.0 - ((1.0 - dst.y) / src.y)), (src.z == 0.0) ? 0.0 : (1.0 - ((1.0 - dst.z) / src.z)));\n  if ( blendmode ==  6 ) return (src + dst) - 1.0;\n  if ( blendmode ==  7 ) return max(src, dst);\n  if ( blendmode ==  8 ) return (src + dst) - (src * dst);\n  if ( blendmode ==  9 ) return vec3((src.x == 1.0) ? 1.0 : min(1.0, dst.x / (1.0 - src.x)), (src.y == 1.0) ? 1.0 : min(1.0, dst.y / (1.0 - src.y)), (src.z == 1.0) ? 1.0 : min(1.0, dst.z / (1.0 - src.z)));\n  if ( blendmode == 10 ) return src + dst;\n  if ( blendmode == 11 ) return vec3((dst.x <= 0.5) ? (2.0 * src.x * dst.x) : (1.0 - 2.0 * (1.0 - dst.x) * (1.0 - src.x)), (dst.y <= 0.5) ? (2.0 * src.y * dst.y) : (1.0 - 2.0 * (1.0 - dst.y) * (1.0 - src.y)), (dst.z <= 0.5) ? (2.0 * src.z * dst.z) : (1.0 - 2.0 * (1.0 - dst.z) * (1.0 - src.z)));\n  if ( blendmode == 12 ) return vec3((src.x <= 0.5) ? (dst.x - (1.0 - 2.0 * src.x) * dst.x * (1.0 - dst.x)) : (((src.x > 0.5) && (dst.x <= 0.25)) ? (dst.x + (2.0 * src.x - 1.0) * (4.0 * dst.x * (4.0 * dst.x + 1.0) * (dst.x - 1.0) + 7.0 * dst.x)) : (dst.x + (2.0 * src.x - 1.0) * (sqrt(dst.x) - dst.x))), (src.y <= 0.5) ? (dst.y - (1.0 - 2.0 * src.y) * dst.y * (1.0 - dst.y)) : (((src.y > 0.5) && (dst.y <= 0.25)) ? (dst.y + (2.0 * src.y - 1.0) * (4.0 * dst.y * (4.0 * dst.y + 1.0) * (dst.y - 1.0) + 7.0 * dst.y)) : (dst.y + (2.0 * src.y - 1.0) * (sqrt(dst.y) - dst.y))), (src.z <= 0.5) ? (dst.z - (1.0 - 2.0 * src.z) * dst.z * (1.0 - dst.z)) : (((src.z > 0.5) && (dst.z <= 0.25)) ? (dst.z + (2.0 * src.z - 1.0) * (4.0 * dst.z * (4.0 * dst.z + 1.0) * (dst.z - 1.0) + 7.0 * dst.z)) : (dst.z + (2.0 * src.z - 1.0) * (sqrt(dst.z) - dst.z))));\n  if ( blendmode == 13 ) return vec3((src.x <= 0.5) ? (2.0 * src.x * dst.x) : (1.0 - 2.0 * (1.0 - src.x) * (1.0 - dst.x)), (src.y <= 0.5) ? (2.0 * src.y * dst.y) : (1.0 - 2.0 * (1.0 - src.y) * (1.0 - dst.y)), (src.z <= 0.5) ? (2.0 * src.z * dst.z) : (1.0 - 2.0 * (1.0 - src.z) * (1.0 - dst.z)));\n  if ( blendmode == 14 ) return vec3((src.x <= 0.5) ? (1.0 - (1.0 - dst.x) / (2.0 * src.x)) : (dst.x / (2.0 * (1.0 - src.x))), (src.y <= 0.5) ? (1.0 - (1.0 - dst.y) / (2.0 * src.y)) : (dst.y / (2.0 * (1.0 - src.y))), (src.z <= 0.5) ? (1.0 - (1.0 - dst.z) / (2.0 * src.z)) : (dst.z / (2.0 * (1.0 - src.z))));\n  if ( blendmode == 15 ) return 2.0 * src + dst - 1.0;\n  if ( blendmode == 16 ) return vec3((src.x > 0.5) ? max(dst.x, 2.0 * (src.x - 0.5)) : min(dst.x, 2.0 * src.x), (src.x > 0.5) ? max(dst.y, 2.0 * (src.y - 0.5)) : min(dst.y, 2.0 * src.y), (src.z > 0.5) ? max(dst.z, 2.0 * (src.z - 0.5)) : min(dst.z, 2.0 * src.z));\n  if ( blendmode == 17 ) return abs(dst - src);\n  if ( blendmode == 18 ) return src + dst - 2.0 * src * dst;\n  return src + dst;\n}\n/* custom_helpers */")),e.fragmentShader=e.fragmentShader.replace("/* custom_main */","vec3 "+t.uuid+"_output = blend( "+r.uuid+"_output * "+t.uuid+"_alpha1,"+o.uuid+"_output * "+t.uuid+"_alpha2, "+t.uuid+"_blendmode );\n  /* custom_main */")},t.update=function(){},t.render=function(){return a},t.alpha1=function(){return i},t.alpha2=function(){return u},t.mixMode=function(e){return null!=e&&(c=e),c},t.blendMode=function(n){return null!=n&&(s=n,e.customUniforms[t.uuid+"_blendmode"].value=s),s},t.pod=function(n){return null!=n&&(a=n,1==c&&(i=a,u=1-a),2==c&&(i=Math.round(a),u=Math.round(1-a)),3==c&&((i=2*a)>1&&(i=1),(u=2-2*a)>1&&(u=1)),4==c&&(i=2*a,u=2-2*a),5==c&&((i=2*a)>1&&(i=1),(u=2-2*a)>1&&(u=1),i+=.36,u+=.36),6==c&&(i=1,u=0),7==c&&(i=0,u=1),8==c&&(i=.5,u=.5),9==c&&(i=1,u=1),e.customUniforms[t.uuid+"_alpha1"].value=i,e.customUniforms[t.uuid+"_alpha2"].value=u),a}}function Output(e,n){this.uuid="Output_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),this.type="Module",e.add(this);var t=n;this.init=function(){e.fragmentShader=e.fragmentShader.replace("/* custom_main */","\n  gl_FragColor = vec4( "+t.uuid+"_output, 1.0 );\n")},this.update=function(){}}function Switcher(e,n){var t=this;t.sources=n,t.uuid="Switcher_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),t.type="Module",e.add(t),t.active_source=0,t.init=function(){e.customUniforms[t.uuid+"_active_source"]={type:"i",value:1},e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform int "+t.uuid+"_active_source;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec4 "+t.uuid+"_output;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_helpers */","\nvec3 get_source_"+t.uuid+" ( int active_source, vec3 src1, vec3 src2 ) {\n  if ( active_source ==  0 ) return src1;\n  if ( active_source ==  1 ) return src2;\n}"),e.fragmentShader=e.fragmentShader.replace("/* custom_main */","vec3 "+t.uuid+"_output = get_source_"+t.uuid+"("+t.uuid+"_active_source, "+n[0].uuid+"_output, "+n[1].uuid+"_output );\n  /* custom_main */")},t.update=function(){},t.render=function(){return t.sources[t.active_source]},t.doSwitch=function(n){return null==n?0==t.active_source?t.active_source=1:t.active_source=0:0!=n&&1!=n?console.log(t.uuid,n,"not allowed"):t.active_source=n,e.customUniforms[t.uuid+"_active_source"]={type:"i",value:t.active_source},t.active_source}}function Source(e,n){this.type="Source",this.init=function(){},this.update=function(){},this.render=function(){},this.start=function(){},this.src=function(e){},this.play=function(){},this.pause=function(){},this.paused=function(){},this.currentFrame=function(e){},this.duration=function(){}}function GifSource(e,n){var t,r,o,i,u,a=this;null==n.uuid?a.uuid="GifSource_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):a.uuid=n.uuid,(a=this).type="GifSource",a.bypass=!0,e.add(a);a.init=function(){(t=document.createElement("canvas")).width=1024,t.height=1024,o=t.getContext("2d"),i=new THREE.Texture(t),e.customUniforms[a.uuid]={type:"t",value:i},e.customUniforms[a.uuid+"_alpha"]={type:"f",value:1},e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform sampler2D "+a.uuid+";\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec3 "+a.uuid+"_output;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform float "+a.uuid+"_alpha;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_main */","vec3 "+a.uuid+"_output = ( texture2D( "+a.uuid+", vUv ).xyz * "+a.uuid+"_alpha );\n  /* custom_main */"),a.gif=u,a.canvas=t,window.image_source=new Image,(r=document.createElement("div")).setAttribute("id","gif_"+a.uuid),r.setAttribute("rel:auto_play","1"),u=new SuperGif({gif:r,c_w:"1024px",c_h:"576px"}),console.log(a.uuid," Load..."),u.load_url("http://nabu.sense-studios.com/assets/nabu_themes/sense/slowclap.gif"),a.bypass=!1},a.update=function(){try{o.clearRect(0,0,1024,1024),o.drawImage(u.get_canvas(),0,0,1024,1024),i&&(i.needsUpdate=!0)}catch(e){}},a.render=function(){return i},a.src=function(e){(r=document.createElement("div")).setAttribute("id","gif_"+a.uuid),r.setAttribute("rel:auto_play","1"),(u=new SuperGif({gif:r,c_w:"1024px",c_h:"576px"})).load_url(e)},a.play=function(){return u.play()},a.pause=function(){return u.pause()},a.paused=function(){return!u.get_playing()},a.currentFrame=function(e){return void 0===e?u.get_current_frame():(u.move_to(e),e)},a.duration=function(){return u.get_length()}}function SolidSource(e,n){var t,r=this;null==n.uuid?r.uuid="SolidSource_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):r.uuid=n.uuid,r.bypass=!0,e.add(r);var o={r:0,g:0,b:0};null!=n&&(t=n),r.init=function(){console.log("init solid",t),null!=t.color&&(o=t.color),e.customUniforms[r.uuid+"_color"]={type:"v3",value:new THREE.Vector3(o.r,o.g,o.b)},e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec3 "+r.uuid+"_color;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec3 "+r.uuid+"_output;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_main */","vec3 "+r.uuid+"_output = "+r.uuid+"_color;\n  /* custom_main */")},r.update=function(){},r.render=function(){return o},r.color=function(n){return null!=n&&(o=n,e.customUniforms[r.uuid+"_color"]={type:"v3",value:new THREE.Vector3(o.r,o.g,o.b)}),o}}function TextSource(e,n){var t,r,o,i,u=this;null==n.uuid?u.uuid="TextSource_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):u.uuid=n.uuid,u.type="TextSource",u.bypass=!0,e.add(u);u.init=function(){console.log("init text source",u.uuid),(r=document.createElement("DIV")).innerHTML="<h1>IF I FELL IN EFFECT</h1>",console.log("created div element: ",r),r.height=1024,r.width=1024,u.firstplay=!1,t=document.createElement("canvas"),document.body.appendChild(t),t.width=1024,t.height=1024,o=t.getContext("2d"),i=new THREE.CanvasTexture(t),e.customUniforms[u.uuid]={type:"t",value:i},e.customUniforms[u.uuid+"_alpha"]={type:"f",value:1},e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform sampler2D "+u.uuid+";\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec3 "+u.uuid+"_output;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform float "+u.uuid+"_alpha;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_main */","vec3 "+u.uuid+"_output = ( texture2D( "+u.uuid+", vUv ).xyz * "+u.uuid+"_alpha );\n  /* custom_main */"),u.divElement=r,u.canvas=t,u.bypass=!1};var a="Fear...,    Is the, mind, killer,    ..................................,    In, the, space, of, the, heart..., is, a, place, of, no, FEAR...!,    ..................................................................,    A feeling, without limits, that you cannot, ENGINEER!,    ..................................................................,    Fear is, the mind, killer.......,    ..................................................................,    Whoever said, we're not, supposed to get, ECSTATIC?,    ..................................................................,    Fear is, the mind, killer.......,    ..................................,    ..................................,    NO........, FEAR.......,    ..................................,    ..................................,    NO........, FEAR.......,    ..................................,    Fear is, the mind, killer.......,    .............................................,    It's a, media-induced, comatose, ANAESTHETIC!,    .............................................,    Fear is, the, MIND, KILLER    ...........................................................................,    It's a, media-induced, comatose, ANAESTHETIC!,    .............................................,    Fear is, the mind, killer.......,    .............................................,    In, the, space, of, the, heart..., is, a, place, of, no, FEAR...!,    .............................................,    Fear is, the mind, killer.......,    .............................................,",c=0,s="",d=0,m=12,l=600,f=300,p=64,h=512;u.update=function(){p*=.99,(u.bypass=!1)||(o.clearRect(0,0,t.width,t.height),o.fillStyle="rgba(60, 60, 60, 0.4)",o.font="604px IMPACT",o.textAlign="center",o.fillText(s.split(".").join(""),10*bpm.render()+f,l),o.fillStyle="white",o.font=p+"px IMPACT",o.textAlign="center",o.fillText(s.split(".").join(""),h,460),c>m&&(s=a.split(",")[d],m=a.split(",")[d].length*(bpm.bpm/72)+3,++d==a.split(",").length&&(d=0),c=0,l=Math.floor(200*Math.random())+600,f=Math.floor(200*Math.random())+200,h=Math.floor(100*Math.random())+470,p=Math.floor(30*Math.random())+70),c++,i&&(i.needsUpdate=!0))},u.render=function(){return i},u.alpha=function(n){if(null==n)return e.customUniforms[u.uuid+"_alpha"].value;e.customUniforms[u.uuid+"_alpha"].value=n}}function VideoSource(e,n){var t,r,o,i,u=this;null==n.uuid?u.uuid="VideoSource_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):u.uuid=n.uuid,u.type="VideoSource",u.bypass=!0,e.add(u);u.init=function(){console.log("init video source",u.uuid),(r=document.createElement("video")).setAttribute("crossorigin","anonymous"),r.muted=!0,null==n.src?r.src="//nabu-dev.s3.amazonaws.com/uploads/video/567498216465766873000000/720p_h264.mp4":r.src=n.src,console.log("loaded source: ",r.src),r.height=1024,r.width=1024,r.loop=!0,r.load(),u.firstplay=!1;var a=setInterval(function(){if(4==r.readyState){var e=Math.random()*r.duration;r.currentTime=e,r.play(),u.firstplay=!0,console.log(u.uuid,"First Play; ",e),clearInterval(a)}},400);$("body").click(function(){r.play(),u.firstplay=!0}),r.volume=0,(t=document.createElement("canvas")).width=1024,t.height=1024,o=t.getContext("2d"),i=new THREE.Texture(t),e.customUniforms[u.uuid]={type:"t",value:i},e.customUniforms[u.uuid+"_alpha"]={type:"f",value:1},e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform sampler2D "+u.uuid+";\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec3 "+u.uuid+"_output;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform float "+u.uuid+"_alpha;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_main */","vec3 "+u.uuid+"_output = ( texture2D( "+u.uuid+", vUv ).xyz * "+u.uuid+"_alpha );\n  /* custom_main */"),u.video=r,u.canvas=t,u.bypass=!1},u.update=function(){(u.bypass=!1)||r.readyState===r.HAVE_ENOUGH_DATA&&(o.drawImage(r,0,0,1024,1024),i&&(i.needsUpdate=!0))},u.render=function(){return i},u.src=function(e){r.src=e;var n=setInterval(function(){4==r.readyState&&(r.play(),console.log(u.uuid,"First Play."),clearInterval(n))},400)},u.play=function(){return r.play()},u.pause=function(){return r.pause()},u.paused=function(){return r.paused},u.currentTime=function(e){return void 0===e?r.currentTime:(console.log("set time",e),r.currentTime=e,e)},u.duration=function(){return r.duration},u.alpha=function(n){if(null==n)return e.customUniforms[u.uuid+"_alpha"].value;e.customUniforms[u.uuid+"_alpha"].value=n}}change_blendmode(),change_mixmode(),jumps(),scratch(),GifSource.prototype=new Source,GifSource.constructor=GifSource,SolidSource.prototype=new Source,SolidSource.constructor=SolidSource,TextSource.prototype=new Source,TextSource.constructor=TextSource,VideoSource.prototype=new Source,VideoSource.constructor=VideoSource;