var GlRenderer=function(){console.log("created renderer");var e=this;e.scene=new THREE.Scene,e.camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),e.camera.position.z=20,e.nodes=[],e.customUniforms={},e.customDefines={},e.vertexShader="\n    varying vec2 vUv;    void main() {      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );      vUv = uv;    }\n  ",e.fragmentShader="\n    uniform sampler2D textureTest;\n    uniform float wave;\n    /* custom_uniforms */    /* custom_helpers */    varying vec2 vUv;    void main() {      /* custom_main */    }\n  ",e.init=function(){console.log("init renderer"),e.glrenderer=new THREE.WebGLRenderer({canvas:glcanvas,alpha:!1}),e.nodes.forEach(function(e){e.init()}),e.shaderMaterial=new THREE.ShaderMaterial({uniforms:e.customUniforms,defines:e.customDefines,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,side:THREE.DoubleSide,transparent:!0}),e.flatGeometry=new THREE.PlaneGeometry(67,38),e.flatGeometry.translate(0,0,0),e.surface=new THREE.Mesh(e.flatGeometry,e.shaderMaterial),e.scene.add(e.surface)};Math.round(100*Math.random());e.render=function(){requestAnimationFrame(e.render),e.glrenderer.render(e.scene,e.camera),e.glrenderer.setSize(window.innerWidth,window.innerHeight),e.nodes.forEach(function(e){e.update()})},e.add=function(t){e.nodes.push(t)},e.dispose=function(){e.shaderMaterial,e.flatGeometry,e.scene.remove(e.surface),e.glrenderer.resetGLState(),e.customUniforms={},e.customDefines={},e.vertexShader="\n      varying vec2 vUv;\n      void main() {\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        vUv = uv;\n      }\n    ",e.fragmentShader="\n      uniform sampler2D textureTest;\n      ununiform float wave;\n      /* custom_uniforms */\n      /* custom_helpers */\n      varying vec2 vUv;\n      void main() {\n        /* custom_main */\n      }\n    ",e.nodes=[]}};function AudioAnalysis(e,t){var n=this;n.uuid="Analysis_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),n.type="Addon",n.audio="",n.bypass=!1,n.bpm=128,n.bpm_float=128,n.mod=1,n.bps=1,n.sec=0,n.options={audio:"/radio/nsb"},null!=t&&(n.options=t);var o=!0,r=[],i=0,u=(new Date).getTime();e.add(n);var a=new Audio;n.audio=a;var c,s=new AudioContext,d=s.createMediaElementSource(a),l=s.createBiquadFilter(),m=s.createAnalyser(),f=Date.now(),p=new Array(4e3),h=new Array(4e3),g=[],v=1,_=[];console.log("SET AUDIO SRC"),a.src=n.options.audio,n.audio_src=n.options.audio,a.controls=!0,a.loop=!0,a.autoplay=!0,l.type="lowpass",l.frequency.value=350,l.Q.value=1,m.fftSize=128,c=m.frequencyBinCount;var y=function(){console.log("AudioAnalysis is re-intialized after click initialized!",a.src),a.play(),document.body.webkitRequestFullScreen(),document.body.removeEventListener("click",y)};document.body.addEventListener("click",y),n.disconnectOutput=function(){d.disconnect(s.destination)},n.connectOutput=function(){d.connect(s.destination)},n.init=function(){console.log("init AudioAnalysis Addon."),S()},n.update=function(){n.bypass||(n.disabled||r.forEach(function(e){e(n.render())}),n.bpm=n.tempodata_bpm,i=((new Date).getTime()-u)/1e3,n.sec=i*Math.PI*(n.bpm*n.mod)/60,n.bpm_float=(Math.sin(n.sec)+1)/2)},n.render=function(){return n.bpm_float},n.add=function(e){r.push(e)};var b=new Promise(function(e,t){d.connect(l),l.connect(m),d.connect(s.destination),e(a),t(err)}),S=function(){b.then(function(e){console.log("AudioAnalysis is initialized!",a.src),a.play(),console.log("AudioAnalysis start sampling!"),setInterval(w,1)}).catch(function(e){console.log("Error: AudioAnalysis ERROR ",e)})},w=function(){if(!n.audio.muted&&!n.bypass){var e=new Uint8Array(c);m.getByteTimeDomainData(e);var t=Date.now(),o=0;if(e.forEach(e=>{e>o&&(o=e)}),p.push([t,o]),p.length>4e3&&p.splice(0,p.length-4e3),0,t-f>100){var r=E(p);n.tempodata_bpm=r.bpm,n.useAutoBPM&&(n.sec=i*Math.PI*(r.bpm*n.mod)/60),f=Date.now(),0}}},x=function(){0!=document.getElementsByClassName("blink").length&&(a.paused?document.getElementsByClassName("blink")[0].style.opacity=0:1==document.getElementsByClassName("blink")[0].style.opacity?document.getElementsByClassName("blink")[0].style.opacity=0:document.getElementsByClassName("blink")[0].style.opacity=1,setTimeout(x,60/n.bpm*1e3/n.mod))};x();var E=function(e){g=[],h=new Array(e.length);for(var t=0;t<e.length;t++)void 0!==e[t]&&e[t][1]>128*v&&(h[t]=[p[t][0],1],g.push([e[t][0],1]),t+=50);g.length<15&&(v-=.05),g.length>60&&(v+=.05),v>2&&(v=2),v<1&&(v=1);var n=C(T(g));if(n.sort(M),0==n.length)n[0]={tempo:0};else{var r="";n.reverse().forEach(function(e,t){r+=t+", "+e.tempo+", "+e.count+"\t [";for(var n=0;n<e.count;)r+="#",n++;r+="]<br/>"}),null!=document.getElementById("info")&&(document.getElementById("info").html=r)}var i="calibrating";if(o=!1,void 0===e[0])o=!0,document.getElementsByClassName("blink").length>0&&(document.getElementsByClassName("blink")[0].style.backgroundColor="#999999");else{if(o=!1,void 0===n[0]||void 0===n[1])return void console.log("holdit");var u=n[0].count-n[1].count;u<=2?(i="low",document.getElementsByClassName("blink").length>0&&(document.getElementsByClassName("blink")[0].style.backgroundColor="#990000")):u>2&&u<=7?(i="average",document.getElementsByClassName("blink").length>0&&(document.getElementsByClassName("blink")[0].style.backgroundColor="#999900")):u>7&&(i="high",document.getElementsByClassName("blink").length>0&&(document.getElementsByClassName("blink")[0].style.backgroundColor="#CCCCCC"))}return{bpm:n[0].tempo,confidence:i,calibrating:o,treshold:v,tempoCounts:n,foundpeaks:g,peaks:h}},M=function(e,t){return parseInt(e.count,10)-parseInt(t.count,10)},T=function(e){return _=[],e.forEach(function(t,n){for(var o=0;o<10;o++)if(void 0!==e[n+o]){var r=e[n+o][0]-t[0];_.some(function(e){if(e.interval===r)return e.count++})||_.push({interval:r,count:1})}}),_},C=function(e){var t=[];return e.forEach(function(e,n){if(0!=e.interval&&!isNaN(e.interval))var o=60/(e.interval/1e3);for(;o<90;)o*=2;for(;o>180;)o/=2;o=2*Math.round(o/2),t.some(function(t){if(t.tempo===o)return t.count+=e.count})||o&&t.push({tempo:o,count:e.count})}),t}}function BPM(e,t){var n=this;if(n.function_list=[["AUTO","method","toggleAutoBpm"],["MODDOWN","method","modDown"],["MODUP","method","modUp"],["MOD","method","modNum"]],null!=e){n.uuid="BPM_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),window["bpm_"+n.uuid],n.type="Addon",n.options={},null!=t&&(n.options=t),n.bpm=128,n.bps=2.133333,n.sec=0,n.bpm_float=.46875,n.mod=1,n.useAutoBpm=!1,n.tempodata_bpm=128,n.mute=!1,n.autoBpmData={},n.audio_src="",n.useMicrophone=!1,n.bypass=!1;var o=[],r=0;e.add(n),n.init=function(){console.log("init BPM contoller.")};var i=(new Date).getTime();n.update=function(){n.bypass||(n.disabled||o.forEach(function(e){e(n.render())}),r=((new Date).getTime()-i)/1e3,n.sec=r*Math.PI*(n.bpm*n.mod)/60,n.bpm_float=(Math.sin(n.sec)+1)/2)},n.add=function(e){o.push(e)},n.render=function(){return n.bpm_float},n.modUp=function(){n.mod*=2},n.modDown=function(){n.mod*=.5},n.modNum=function(e){console.log("MOD ",e);var t=n.useAutoBpm;n.mod=e,n.useAutoBpm=t},n.toggleAutoBpm=function(e){n.useAutoBpm=!n.useAutoBpm,console.log("---\x3e",n.useAutoBpm)},n.turnOff=function(){bpm.audio.muted=!1,bpm.useAutoBpm=!1};var u=Number(new Date),a=[128,128,128,128,128],c=0,s=0;n.tap=function(){n.useAutoBPM=!1,c=Number(new Date)-u,u=Number(new Date),c<1e4&&c>10&&(a.splice(0,1),a.push(6e4/c),s=a.reduce(function(e,t){return e+t})/a.length,n.bpm=s,n.bps=s/60)},console.log("set keypress"),window.addEventListener("keypress",function(e){console.log(">>> ",e.which),116!=e.which&&32!=e.which||(n.tap(),console.log(n.bpm))})}}function FileManager(e){var t=this;try{renderer}catch(e){return void(t.function_list=[["CHANGE","method","changez"],["POD","set","pod"]])}t.uuid="Filemanager_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),t.type="AddOn",t.defaultQuality="",t.source=e,t.set=[],t.file,t.renderer=renderer,t.load_set=function(e){(new Utils).get(e,function(e){console.log("--\x3e",e),t.set=JSON.parse(e)})},t.setSrc=function(e){console.log("set source: ",e),t.source.src(e)},t.getFileById=function(e){},t.getSrcByTags=function(e){if(0==programs.length)return"no programs";var n=[];if(programs.forEach(function(t,o){e.forEach(function(e,o){t.tags.includes(e)&&null!=t.assets&&"Video"==t.assets._type&&n.push(t)})}),0==n.length)return"no matches";var o=n[Math.floor(Math.random()*n.length)];console.log(">> ",n.length,o.title),t.setSrc(t.getSrcByQuality(o))},t.load=function(e){utils.get(e,function(e){console.log("got:",JSON.parse(e)),t.set=JSON.parse(e)})},t.change=function(e){if(0!=t.set.length){var n=t.set[Math.floor(Math.random()*t.set.length)];console.log("from set:",n),t.setSrc(n)}},t.changez=function(e){t.change(e)},t.getSrcByQuality=function(e,t){null==t&&(t="720p_h264");var n=null;return e.assets.versions.forEach(function(e){e.label==t&&(n=e)}),n.url}}function GiphyManager(e){var t=this;t.uuid="GiphyManager_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),t.type="AddOn",t.source=e,t.file,t.programs,t.program,t.renderer=renderer;t.needle=function(e){utils.get("http://api.giphy.com/v1/gifs/search?api_key=tIovPHdiZhUF3w0UC6ETdEzjYOaFZQFu&q="+e,function(e){t.programs=e.data,console.log(" === GIPHY (re)LOADED === ")})},t.search=function(e){t.needle(e)},t.setSrc=function(e){console.log("set source: ",e),t.source.src(e)},t.change=function(){if(0==t.programs.length)return"no programs";t.program=t.programs[Math.floor(Math.random()*t.programs.length)],t.setSrc(t.program.images.original.url)},t.changez=function(){t.change()},t.needle("vj")}function Behaviour(e,t){var n=this;function o(e){"seconds"==e.mod.type?triggers.push([e,n.time+e.mod.value,null]):"beats"==e.mod.type?triggers.push([e,n.beats+e.mod.value]):"random-seconds"==e.mod.type?triggers.push([e,n.time+Math.random()*e.mod.value,null]):"random-beats"==e.mod.type&&triggers.push([e,n.beats+Math.random()*e.mod.value])}n.uuid="Behaviour"+(4294967296*(1+Math.random())|0).toString(16).substring(1),n.type="Behaviour",n.beats=0,n.time=(new Date).getTime(),n.script={},n.sheets=[],n.sheet_index=0,n.bpm=t.bpm,e.add(n),triggers=[],n.tr=triggers,old_bpm=1,n.init=function(){},n.update=function(){n.time=(new Date).getTime();var e=Math.round(4*bpm.render());e!=old_bpm&&(n.beats+=1,old_bpm=e)},n.load=function(e){n.script=e,n.sheets=e.sheets,console.log("loaded A BEHAVIOUR",e.title),e.triggers.forEach(function(e,t){o(e)})},n.jump=function(e){console.log("how high?",e),e.video.currentTime=Math.random()*e.video.duration};var r=0;n.checkSheets=function(){n.sheets[0].length;checkBeats(r%n.sheets[n.sheet_index].length),n.sheets[n.sheet_index][r%n.sheets[n.sheet_index].length].forEach(function(e){if("....."!=e[0]){console.log(e);var t=n.script.composition[e[0]].target,o=n.script.composition[e[0]].functions,r=null;o.forEach(function(n,o){if(e[1]==n[0]){console.log("TRIGGERED",r=n[2]);var i=e[2];i=isNaN(e[2])?e[2]:parseFloat(e[2]),t[n[2]](i),console.log(t,r,i)}})}}),r+=1,setTimeout(n.checkSheets,60/bpm.bpm*1e3/4)};setTimeout(function(){},12e3)}function FireBaseControl(e,t,n,o){this.uuid="FireBaseControl_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),this.type="Control",this.clients={},this.bypass=!0;var r,i,u=[],a=[];e.add(this);var c=0,s=0;this.init=function(){console.log("init FireBase contoller.");var e;firebase.initializeApp({apiKey:"AIzaSyDgrYfOUDN1QLRDcY4z45WwkcOjkXiImNQ",authDomain:"mixerbase-829c2.firebaseapp.com",databaseURL:"https://mixerbase-829c2.firebaseio.com",storageBucket:"mixerbase-829c2.appspot.com",messagingSenderId:"568387460963"}),r=firebase.database(),"/client_1/",i=r.ref("/client_1/"),[],i.on("value",function(e){}),i.child("gamepad/leftx").on("value",function(e){c=e.val(),d(c,s)}),i.child("gamepad/lefty").on("value",function(e){s=e.val(),d(c,s)}),i.child("gamepad/button_1").on("value",function(t){clearTimeout(e),e=setTimeout(function(){giphymanager1.change()},200)}),i.child("gamepad/button_2").on("value",function(t){clearTimeout(e),e=setTimeout(function(){filemanager2.change()},200)}),i.child("gamepad/button_3").on("value",function(t){clearTimeout(e),e=setTimeout(function(){filemanager3.change()},200)}),i.child("gamepad/button_4").on("value",function(t){clearTimeout(e),e=setTimeout(function(){filemanager4.change()},200)});for(var t=0;t<17;)i.child("mobilepad/button_"+t).on("value",function(e){console.log("i click you",t,e.key)}),t++},this.update=function(){},this.render=function(){},this.addMixer=function(e){u.push(e)},this.addFileManager=function(e){a.push(e)};var d=function(e,r){console.log("update mixers"),t.pod(e/2+.5),n.pod(e/2+.5),o.pod(r/2+.5)}}function GamePad(e,t,n,o){var r=this;r.uuid="GamePad_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),r.type="Control",r.controllers={},r.bypass=!0;var i,u,a,c,s=[];e.add(r),r.init=function(){console.log("init GamepadController contoller."),window.addEventListener("gamepadconnected",d)},r.update=function(){if(!r.bypass){navigator.getGamepads()[0].buttons;navigator.getGamepads()[0].buttons.forEach(function(e,t){e.pressed&&(console.log(" i press you ",t,e),0==t&&(clearTimeout(i),i=setTimeout(function(){filemanager1.change()},200)),1==t&&(clearTimeout(u),u=setTimeout(function(){filemanager2.change()},200)),2==t&&(clearTimeout(a),a=setTimeout(function(){filemanager3.change()},200)),3==t&&(clearTimeout(c),c=setTimeout(function(){filemanager4.change()},200)))});var e=navigator.getGamepads()[0].axes,s=e[0],d=e[1];e[5],e[6],e[9];t.pod(s/2+.5),n.pod(s/2+.5),o.pod(d/2+.5)}},r.add=function(e){s.push(e)},r.render=function(){return r.controllers};var d=function(e){var t;console.log("Gamepad connected at index %d: %s. %d buttons, %d axes.",e.gamepad.index,e.gamepad.id),t=e.gamepad,r.controllers[t.index]=t,console.log(t.id,t.index),r.bypass=!1}}function GamePadHorizontalControl(e){}function GamePadVerticalControl(e){}function MidiController(e,t){var n=this;n.uuid="Midi_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),n.type="Control",n.controllers={},n.bypass=!0;e.add(n);var r,u,a=0,c=1,s=2,d=4,l=5,m=[[56,57,58,59,60,61,62,63],[48,49,50,51,52,53,54,55],[40,41,42,43,44,45,46,47],[32,33,34,35,36,37,38,39],[24,25,26,27,28,29,30,31],[16,17,18,19,20,21,22,23],[8,9,10,11,12,13,14,15],[0,1,2,3,4,5,6,7]],f=[64,65,66,67,68,69,70,71,82,83,84,85,86,87,88,89],p=[0,0,0,0,0,0,0,0,0],h=[0,0,0,0,0,0,0,0,0],g=[];function v(){var e=[];m.forEach(function(t,n){t.forEach(function(t,n){e.push(144,t,d)})}),f.forEach(function(t,n){e.push(144,t,a)}),u.send(e);var t=!0;n.blinkCallBack=function(e){t?(u.send([144,82,a]),t=!1):(u.send([144,82,c]),t=!0)}}navigator.requestMIDIAccess&&navigator.requestMIDIAccess().then(function(e){console.log("We have midi!09po ");var t=(r=e).inputs.values(),n=r.outputs.values();for(i=t.next();i&&!i.done;i=t.next())i.value.onmidimessage=S;for(o=n.next();o&&!o.done;o=n.next())u=o.value,v()},function(){console.error("No access to your midi devices.")});var _=[0,0,0,0],y=[128,144,128,144],b=!1;function S(e){if(!b){if(_.unshift([e.data[0],e.data[1]]),_.pop(),_.map(function(e){return e[0]}).join(",")==y.join(",")&&(console.log("blink1"),g.forEach(function(t,n){t.btn==e.data[1]&&t.cb(e.data,!0)}),_.map(function(e){return e[1]}).every((e,t,n)=>e===n[0])))return _=[0,0,0,0],u.send([144,e.data[1],s]),b=!0,h[e.data[1]]=1,void setTimeout(function(){_=[0,0,0,0],b=!1},350);if(g.forEach(function(t,n){t.btn==e.data[1]&&t.cb(e.data,!1)}),setTimeout(function(){_=[0,0,0,0],b=!1},350),48==e.data[1]&&(p[0]=e.data[2]),49==e.data[1]&&(p[1]=e.data[2]),50==e.data[1]&&(p[2]=e.data[2]),51==e.data[1]&&(p[3]=e.data[2]),64==e.data[1]){var t=[];m.forEach(function(e,n){e.forEach(function(e,n){t.push(144,e,a)})}),f.forEach(function(e,n){t.push(144,e,a)}),u.send(t)}else if(65==e.data[1]){t=[];m.forEach(function(e,n){e.forEach(function(e,n){t.push(144,e,l)})}),u.send(t)}else 128==e.data[0]&&(u.send([144,e.data[1],a]),b=!1),144==e.data[0]&&(u.send([144,e.data[1],c]),h[e.data[1]]=0,b=!1)}}n.init=function(){console.log("init MidiController contoller.")},n.update=function(){},n.addEventListener=function(e,t){g.push({btn:e,cb:t})},n.scheme=function(){}}function NumpadBpmMixerControl(e,t,n){this.uuid="NumpadBpmMixer_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),this.type="Control",this.controllers={};var o=[],r=[];e.add(this),this.init=function(){window.addEventListener("keydown",c),window.addEventListener("keyup",s)},this.update=function(){},this.render=function(){},this.addMixer=function(e){r.push(e)},this.addBpm=function(e){o.push(e)};var i,u=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18],a=[1,2,3,4,5,6,7,8,9];document.body.addEventListener("click",function(){o.forEach(function(e){e.tap()})});var c=function(e){console.log("had key: ",e.which),[[109,function(){o.forEach(function(e){e.bpm-=1})}],[107,function(){o.forEach(function(e){e.bpm+=1})}],[106,function(){o.forEach(function(e){e.bpm*=2})}],[111,function(){o.forEach(function(e){e.bpm*=.5})}],[101,function(){o.forEach(function(e){e.tap()})}],[96,function(){switcher1.doSwitch(0)}],[110,function(){switcher1.doSwitch(1)}],[75,function(){switcher1.doSwitch(0)}],[76,function(){switcher1.doSwitch(1)}],[66,function(){o.forEach(function(e){e.tap()})}],[32,function(){o.forEach(function(e){e.tap()})}],[81,function(){clearTimeout(i),i=setTimeout(function(){giphymanager1.change()},200)}],[87,function(){clearTimeout(i),i=setTimeout(function(){filemanager2.change("awesome")},200)}],[69,function(){clearTimeout(i),i=setTimeout(function(){filemanager3.change("runner")},200)}],[82,function(){clearTimeout(i),i=setTimeout(function(){filemanager4.change()},200)}],[65,function(){giphymanager1.source.currentFrame(Math.floor(Math.random()*giphymanager1.source.duration()))}],[83,function(){filemanager2.source.currentTime(Math.floor(Math.random()*filemanager2.source.duration()))}],[68,function(){filemanager3.source.currentTime(Math.floor(Math.random()*filemanager3.source.duration()))}],[188,function(){mixer3.pod(mixer3.pod()-.1)}],[190,function(){mixer3.pod(mixer3.pod()+.1)}],[104,function(){r.forEach(function(e){e.blendMode(1),e.mixMode(1),u=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18],a=[1,2,3,4,5,6,7,8,9]})}],[103,function(){u.unshift(u.pop()),r.forEach(function(e){e.blendMode(u[0])})}],[105,function(){u.push(u.shift()),r.forEach(function(e){e.blendMode(u[0])})}],[100,function(){a.unshift(a.pop()),r.forEach(function(e){e.mixMode(a[0])})}],[102,function(){a.push(a.shift()),r.forEach(function(e){e.mixMode(a[0])})}],[97,function(){console.log("mix trans left, down")}],[99,function(){console.log("mmix trans right, down")}]].forEach(function(o){o[0]==e.which&&(o[1](),console.log("numpad Handled key DOWN",o[0],n.bpm,t.mixMode(),t.blendMode()))})},s=function(e){[[97,function(){console.log("mix trans left, up")}],[99,function(){console.log("mmix trans right, up")}]].forEach(function(o){o[0]==e.which&&(o[1](),console.log("numpad Handled key UP",o[0],n.bpm,t.mixMode(),t.blendMode()))})}}function SourceControl(e,t){}function Controller(e,t){this.type="Controller",this.myLittleControllerVar="Wakkawakka",this.init=function(){},this.update=function(){},this.render=function(){},this.add=function(){}}function Midi(){this.uuid="Midi_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),this.type="MidiControl",this.mylittlevar="boejaka"}function Vidi(){this.uuid="Vidi_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),this.type="VidiControl",this.mylittlevar="boejaka"}function BlackAndWhite(e,t){var n=this;null==options.uuid?n.uuid="Effect_BlackAndWhite_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):n.uuid=options.uuid,n.type="Effect";n.init=function(){e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform int "+n.uuid+"_mixmode;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_main */","vec3 "+n.uuid+"_output = blend( "+source1.uuid+"_output ,"+source2.uuid+"_output, "+n.uuid+"_blendmode );\n  /* custom_main */")},n.update=function(){}}function Chain(e,t){var n,o=this;null==t.uuid?o.uuid="Chain_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):o.uuid=t.uuid,e.add(o),null!=t&&(n=t),o.type="Module",o.sources=n.sources,o.sources.forEach(function(t,n){e.customUniforms[o.uuid+"_source"+n+"_alpha"]={type:"f",value:.5}}),o.sources.forEach(function(t,n){e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform float "+o.uuid+"_source"+n+"_alpha;\n/* custom_uniforms */")}),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform float "+o.uuid+"_alpha;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec3 "+o.uuid+"_output;\n/* custom_uniforms */"),o.init=function(){var t="vec3(0.0,0.0,0.0)";o.sources.forEach(function(e,n){t+=" + ("+e.uuid+"_output * "+o.uuid+"_source"+n+"_alpha )"}),t+=";\n",e.fragmentShader=e.fragmentShader.replace("/* custom_main */","vec3 "+o.uuid+"_output = "+t+" /* custom_main */")},o.update=function(){},o.setChainLink=function(t,n){e.customUniforms[o.uuid+"_source"+t+"_alpha"].value=n},o.getChainLink=function(e){return o.sources(e)},o.toggle=function(t,n){void 0===n?1==e.customUniforms[o.uuid+"_source"+t+"_alpha"].value?e.customUniforms[o.uuid+"_source"+t+"_alpha"].value=0:(e.customUniforms[o.uuid+"_source"+t+"_alpha"].value=1,current=t):e.customUniforms[o.uuid+"_source"+t+"_alpha"].value=n}}function Mixer(e,t){var n=this;if(n.function_list=[["BLEND","method","blendMode"],["MIX","method","mixMode"],["POD","set","pod"]],null!=e){null==t.uuid?n.uuid="Mixer_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):n.uuid=t.uuid,e.add(n),null!=t&&t,n.type="Module";var o=1,r=0,i=0,u=1;n.mixmodes=[1,2,3,4,5,6,7,8,9];var a,c,s=1;n.blendmodes=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18],a=t.source1,c=t.source2,n.init=function(){e.customUniforms[n.uuid+"_mixmode"]={type:"i",value:1},e.customUniforms[n.uuid+"_blendmode"]={type:"i",value:1},e.customUniforms[n.uuid+"_alpha1"]={type:"f",value:.5},e.customUniforms[n.uuid+"_alpha2"]={type:"f",value:.5},e.customUniforms[n.uuid+"_sampler"]={type:"t",value:null},e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform int "+n.uuid+"_mixmode;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform int "+n.uuid+"_blendmode;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform float "+n.uuid+"_alpha1;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform float "+n.uuid+"_alpha2;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec4 "+n.uuid+"_output;\n/* custom_uniforms */"),-1==e.fragmentShader.indexOf("vec3 blend ( vec3 src, vec3 dst, int blendmode )")&&(e.fragmentShader=e.fragmentShader.replace("/* custom_helpers */","\nvec3 blend ( vec3 src, vec3 dst, int blendmode ) {\n  if ( blendmode ==  1 ) return src + dst;\n  if ( blendmode ==  2 ) return src - dst;\n  if ( blendmode ==  3 ) return src * dst;\n  if ( blendmode ==  4 ) return min(src, dst);\n  if ( blendmode ==  5)  return vec3((src.x == 0.0) ? 0.0 : (1.0 - ((1.0 - dst.x) / src.x)), (src.y == 0.0) ? 0.0 : (1.0 - ((1.0 - dst.y) / src.y)), (src.z == 0.0) ? 0.0 : (1.0 - ((1.0 - dst.z) / src.z)));\n  if ( blendmode ==  6 ) return (src + dst) - 1.0;\n  if ( blendmode ==  7 ) return max(src, dst);\n  if ( blendmode ==  8 ) return (src + dst) - (src * dst);\n  if ( blendmode ==  9 ) return vec3((src.x == 1.0) ? 1.0 : min(1.0, dst.x / (1.0 - src.x)), (src.y == 1.0) ? 1.0 : min(1.0, dst.y / (1.0 - src.y)), (src.z == 1.0) ? 1.0 : min(1.0, dst.z / (1.0 - src.z)));\n  if ( blendmode == 10 ) return src + dst;\n  if ( blendmode == 11 ) return vec3((dst.x <= 0.5) ? (2.0 * src.x * dst.x) : (1.0 - 2.0 * (1.0 - dst.x) * (1.0 - src.x)), (dst.y <= 0.5) ? (2.0 * src.y * dst.y) : (1.0 - 2.0 * (1.0 - dst.y) * (1.0 - src.y)), (dst.z <= 0.5) ? (2.0 * src.z * dst.z) : (1.0 - 2.0 * (1.0 - dst.z) * (1.0 - src.z)));\n  if ( blendmode == 12 ) return vec3((src.x <= 0.5) ? (dst.x - (1.0 - 2.0 * src.x) * dst.x * (1.0 - dst.x)) : (((src.x > 0.5) && (dst.x <= 0.25)) ? (dst.x + (2.0 * src.x - 1.0) * (4.0 * dst.x * (4.0 * dst.x + 1.0) * (dst.x - 1.0) + 7.0 * dst.x)) : (dst.x + (2.0 * src.x - 1.0) * (sqrt(dst.x) - dst.x))), (src.y <= 0.5) ? (dst.y - (1.0 - 2.0 * src.y) * dst.y * (1.0 - dst.y)) : (((src.y > 0.5) && (dst.y <= 0.25)) ? (dst.y + (2.0 * src.y - 1.0) * (4.0 * dst.y * (4.0 * dst.y + 1.0) * (dst.y - 1.0) + 7.0 * dst.y)) : (dst.y + (2.0 * src.y - 1.0) * (sqrt(dst.y) - dst.y))), (src.z <= 0.5) ? (dst.z - (1.0 - 2.0 * src.z) * dst.z * (1.0 - dst.z)) : (((src.z > 0.5) && (dst.z <= 0.25)) ? (dst.z + (2.0 * src.z - 1.0) * (4.0 * dst.z * (4.0 * dst.z + 1.0) * (dst.z - 1.0) + 7.0 * dst.z)) : (dst.z + (2.0 * src.z - 1.0) * (sqrt(dst.z) - dst.z))));\n  if ( blendmode == 13 ) return vec3((src.x <= 0.5) ? (2.0 * src.x * dst.x) : (1.0 - 2.0 * (1.0 - src.x) * (1.0 - dst.x)), (src.y <= 0.5) ? (2.0 * src.y * dst.y) : (1.0 - 2.0 * (1.0 - src.y) * (1.0 - dst.y)), (src.z <= 0.5) ? (2.0 * src.z * dst.z) : (1.0 - 2.0 * (1.0 - src.z) * (1.0 - dst.z)));\n  if ( blendmode == 14 ) return vec3((src.x <= 0.5) ? (1.0 - (1.0 - dst.x) / (2.0 * src.x)) : (dst.x / (2.0 * (1.0 - src.x))), (src.y <= 0.5) ? (1.0 - (1.0 - dst.y) / (2.0 * src.y)) : (dst.y / (2.0 * (1.0 - src.y))), (src.z <= 0.5) ? (1.0 - (1.0 - dst.z) / (2.0 * src.z)) : (dst.z / (2.0 * (1.0 - src.z))));\n  if ( blendmode == 15 ) return 2.0 * src + dst - 1.0;\n  if ( blendmode == 16 ) return vec3((src.x > 0.5) ? max(dst.x, 2.0 * (src.x - 0.5)) : min(dst.x, 2.0 * src.x), (src.x > 0.5) ? max(dst.y, 2.0 * (src.y - 0.5)) : min(dst.y, 2.0 * src.y), (src.z > 0.5) ? max(dst.z, 2.0 * (src.z - 0.5)) : min(dst.z, 2.0 * src.z));\n  if ( blendmode == 17 ) return abs(dst - src);\n  if ( blendmode == 18 ) return src + dst - 2.0 * src * dst;\n  return src + dst;\n}\n/* custom_helpers */\n")),e.fragmentShader=e.fragmentShader.replace("/* custom_main */","vec3 "+n.uuid+"_output = blend( "+a.uuid+"_output * "+n.uuid+"_alpha1,"+c.uuid+"_output * "+n.uuid+"_alpha2, "+n.uuid+"_blendmode );\n  /* custom_main */")},n.update=function(){},n.render=function(){return i},n.alpha1=function(){return o},n.alpha2=function(){return r},n.mixMode=function(e){return null!=e&&(u=e),u},n.blendMode=function(t){return null!=t&&(s=t,e.customUniforms[n.uuid+"_blendmode"].value=s),s},n.pod=function(t){return null!=t&&(i=t,1==u&&(o=i,r=1-i),2==u&&(o=Math.round(i),r=Math.round(1-i)),3==u&&((o=2*i)>1&&(o=1),(r=2-2*i)>1&&(r=1)),4==u&&(o=2*i,r=2-2*i),5==u&&((o=2*i)>1&&(o=1),(r=2-2*i)>1&&(r=1),o+=.36,r+=.36),6==u&&(o=1,r=0),7==u&&(o=0,r=1),8==u&&(o=.5,r=.5),9==u&&(o=1,r=1),e.customUniforms[n.uuid+"_alpha1"].value=o,e.customUniforms[n.uuid+"_alpha2"].value=r),i}}}function Output(e,t){this.uuid="Output_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),this.type="Module",e.add(this);var n=t;this.init=function(){e.fragmentShader=e.fragmentShader.replace("/* custom_main */","\n  gl_FragColor = vec4( "+n.uuid+"_output, 1.0 );\n")},this.update=function(){}}function Switcher(e,t){var n=this;n.uuid="Switcher_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),n.type="Module",e.add(n),n.sources=[t.source1,t.source2],n.active_source=0,n.init=function(){console.log("Switcher",n.uuid,n.sources),e.customUniforms[n.uuid+"_active_source"]={type:"i",value:1},e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform int "+n.uuid+"_active_source;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec4 "+n.uuid+"_output;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_helpers */","\nvec3 get_source_"+n.uuid+" ( int active_source, vec3 src1, vec3 src2 ) {\n  if ( active_source ==  0 ) return src1;  if ( active_source ==  1 ) return src2;}"),e.fragmentShader=e.fragmentShader.replace("/* custom_main */","vec3 "+n.uuid+"_output = get_source_"+n.uuid+"("+n.uuid+"_active_source, "+n.sources[0].uuid+"_output, "+n.sources[1].uuid+"_output );\n  /* custom_main */")},n.update=function(){},n.render=function(){return n.sources[n.active_source]},n.doSwitch=function(t){return null==t?0==n.active_source?n.active_source=1:n.active_source=0:0!=t&&1!=t?console.log(n.uuid,t,"not allowed"):n.active_source=t,e.customUniforms[n.uuid+"_active_source"]={type:"i",value:n.active_source},n.active_source}}function Module(e,t){this.type="Module",this.init=function(){},this.update=function(){},this.render=function(){}}function GifSource(e,t){var n,o,r,i,u,a=this;null==t.uuid?a.uuid="GifSource_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):a.uuid=t.uuid,(a=this).type="GifSource",a.bypass=!0,e.add(a),null==t.src?a.currentSrc="/gif/a443ae90a963a657e12737c466ddff95.gif":a.currentSrc=t.src;a.init=function(){(n=document.createElement("canvas")).width=1024,n.height=1024,r=n.getContext("2d"),i=new THREE.Texture(n),e.customUniforms[a.uuid]={type:"t",value:i},e.customUniforms[a.uuid+"_alpha"]={type:"f",value:1},e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform sampler2D "+a.uuid+";\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec3 "+a.uuid+"_output;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform float "+a.uuid+"_alpha;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_main */","vec3 "+a.uuid+"_output = ( texture2D( "+a.uuid+", vUv ).xyz * "+a.uuid+"_alpha );\n  /* custom_main */"),a.gif=u,a.canvas=n,window.image_source=new Image,(o=document.createElement("img")).setAttribute("id","gif_"+a.uuid),o.setAttribute("rel:auto_play","1"),(u=new SuperGif({gif:o,c_w:"1024px",c_h:"576px"})).draw_while_loading=!0,console.log(a.uuid," Load",a.currentSrc,"..."),u.load_url(a.currentSrc,function(){console.log("play gif"),u.play()}),console.log("Gifsource Loaded First source!",a.currentSrc,"!"),a.bypass=!1},a.update=function(){try{r.clearRect(0,0,1024,1024),r.drawImage(u.get_canvas(),0,0,1024,1024),i&&(i.needsUpdate=!0)}catch(e){}},a.render=function(){return i},a.src=function(e){a.currentSrc=e,u.pause(),u.load_url(e,function(){console.log("play gif"),u.play()})},a.play=function(){return u.play()},a.pause=function(){return u.pause()},a.paused=function(){return!u.get_playing()},a.currentFrame=function(e){return void 0===e?u.get_current_frame():(u.move_to(e),e)},a.duration=function(){return u.get_length()}}function MultiVideoSource(e,t){var n,o,r,i=this;null==t.uuid?i.uuid="MultiVideoSource_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):i.uuid=t.uuid,i.type="MultiVideoSource",i.bypass=!0,e.add(i);i.init=function(){console.log("init video source",i.uuid),videoElement=document.createElement("video"),videoElement.setAttribute("crossorigin","anonymous"),videoElement.muted=!0,null==t.src?videoElement.src="//nabu-dev.s3.amazonaws.com/uploads/video/567498216465766873000000/720p_h264.mp4":videoElement.src=t.src,console.log("loaded source: ",videoElement.src),videoElement.height=1024,videoElement.width=1024,videoElement.loop=!0,videoElement.load(),i.firstplay=!1;var u=setInterval(function(){if(4==videoElement.readyState){var e=Math.random()*videoElement.duration;videoElement.currentTime=e,videoElement.play(),i.firstplay=!0,console.log(i.uuid,"First Play; ",e),clearInterval(u)}},400);document.body.addEventListener("click",function(){videoElement.play(),i.firstplay=!0}),videoElement.volume=0,(n=document.createElement("canvas")).width=1024,n.height=1024,o=n.getContext("2d"),r=new THREE.Texture(n),e.customUniforms[i.uuid]={type:"t",value:r},e.customUniforms[i.uuid+"_alpha"]={type:"f",value:1},e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform sampler2D "+i.uuid+";\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec3 "+i.uuid+"_output;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform float "+i.uuid+"_alpha;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_main */","vec3 "+i.uuid+"_output = ( texture2D( "+i.uuid+", vUv ).xyz * "+i.uuid+"_alpha );\n  /* custom_main */"),i.video=videoElement,i.canvas=n,i.bypass=!1},i.update=function(){(i.bypass=!1)||(videoElement.readyState!==videoElement.HAVE_ENOUGH_DATA||videoElement.seeking?(o.clearRect(0,0,1024,1024),i.alpha=0):(o.drawImage(videoElement,0,0,1024,1024),r&&(r.needsUpdate=!0)))},i.render=function(){return r},i.src=function(e){videoElement.src=e;var t=setInterval(function(){4==videoElement.readyState&&(videoElement.play(),console.log(i.uuid,"First Play."),clearInterval(t))},400)},i.play=function(){return videoElement.play()},i.pause=function(){return videoElement.pause()},i.paused=function(){return videoElement.paused},i.currentTime=function(e){return void 0===e?videoElement.currentTime:(console.log("set time",e),videoElement.currentTime=e,e)},i.duration=function(){return videoElement.duration},i.alpha=function(t){if(null==t)return e.customUniforms[i.uuid+"_alpha"].value;e.customUniforms[i.uuid+"_alpha"].value=t},i.jump=function(e){if(null==e||isNaN(e))try{videoElement.currentTime=Math.floor(Math.random()*i.duration())}catch(e){console.log("prevented a race error")}else videoElement.currentTime=e;return videoElement.currentTime}}function SVGSource(e,t){}function SolidSource(e,t){var n,o=this;null==t.uuid?o.uuid="SolidSource_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):o.uuid=t.uuid,o.bypass=!0,e.add(o);var r={r:0,g:0,b:0};null!=t&&(n=t),o.init=function(){console.log("init solid",n),null!=n.color&&(r=n.color),e.customUniforms[o.uuid+"_color"]={type:"v3",value:new THREE.Vector3(r.r,r.g,r.b)},e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec3 "+o.uuid+"_color;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec3 "+o.uuid+"_output;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_main */","vec3 "+o.uuid+"_output = "+o.uuid+"_color;\n  /* custom_main */")},o.update=function(){},o.render=function(){return r},o.color=function(t){return null!=t&&(r=t,e.customUniforms[o.uuid+"_color"]={type:"v3",value:new THREE.Vector3(r.r,r.g,r.b)}),r},o.jump=function(e){console.log("no")}}function TextSource(e,t){var n,o,r,i,u=this;null==t.uuid?u.uuid="TextSource_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):u.uuid=t.uuid,u.type="TextSource",u.bypass=!0,e.add(u);u.init=function(){console.log("init text source",u.uuid),(o=document.createElement("DIV")).innerHTML="<h1> Awaiting text </h1>",o.height=1024,o.width=1024,u.firstplay=!1,n=document.createElement("canvas"),document.body.appendChild(n),n.width=1024,n.height=1024,r=n.getContext("2d"),i=new THREE.CanvasTexture(n),e.customUniforms[u.uuid]={type:"t",value:i},e.customUniforms[u.uuid+"_alpha"]={type:"f",value:1},e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform sampler2D "+u.uuid+";\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec3 "+u.uuid+"_output;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform float "+u.uuid+"_alpha;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_main */","vec3 "+u.uuid+"_output = ( texture2D( "+u.uuid+", vUv ).xyz * "+u.uuid+"_alpha );\n  /* custom_main */"),u.divElement=o,u.canvas=n,u.bypass=!1};var a=null;utils.get("/texts/fear_is_the_mind_killer.txt",function(e){a=e,console.log("get text",e)});var c=0,s="",d=0,l=12,m=600,f=300,p=64,h=512;u.update=function(){p*=.99,(u.bypass=!1)||null!=a&&(r.clearRect(0,0,n.width,n.height),r.fillStyle="rgba(60, 60, 60, 0.4)",r.font="604px IMPACT",r.textAlign="center",r.fillText(s.split(".").join(""),10*bpm.render()+f,m),r.fillStyle="white",r.font=p+"px IMPACT",r.textAlign="center",r.fillText(s.split(".").join(""),h,460),c>l&&(s=a.split(",")[d],l=a.split(",")[d].length*(bpm.bpm/72)+3,++d==a.split(",").length&&(d=0),c=0,m=Math.floor(200*Math.random())+600,f=Math.floor(200*Math.random())+200,h=Math.floor(100*Math.random())+470,p=Math.floor(30*Math.random())+70),c++,i&&(i.needsUpdate=!0))},u.render=function(){return i},u.alpha=function(t){if(null==t)return e.customUniforms[u.uuid+"_alpha"].value;e.customUniforms[u.uuid+"_alpha"].value=t}}function VideoSource(e,t){var n,o,r,i,u=this;null==t.uuid?u.uuid="VideoSource_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):u.uuid=t.uuid,u.type="VideoSource",u.bypass=!0,e.add(u),u.currentSrc="//nabu-dev.s3.amazonaws.com/uploads/video/567498216465766873000000/720p_h264.mp4";u.init=function(){console.log("init video source",u.uuid),(o=document.createElement("video")).setAttribute("crossorigin","anonymous"),o.muted=!0,null==t.src?o.src=u.currentSrc:o.src=t.src,console.log("loaded source: ",o.src),o.height=1024,o.width=1024,o.loop=!0,o.load(),u.firstplay=!1;var a=setInterval(function(){if(4==o.readyState){var e=Math.random()*o.duration;o.currentTime=e,o.play(),u.firstplay=!0,console.log(u.uuid,"First Play; ",e),clearInterval(a)}},400);document.body.addEventListener("click",function(){o.play(),u.firstplay=!0}),o.volume=0,(n=document.createElement("canvas")).width=1024,n.height=1024,r=n.getContext("2d"),i=new THREE.Texture(n),e.customUniforms[u.uuid]={type:"t",value:i},e.customUniforms[u.uuid+"_alpha"]={type:"f",value:1},e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform sampler2D "+u.uuid+";\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec3 "+u.uuid+"_output;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform float "+u.uuid+"_alpha;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_main */","vec3 "+u.uuid+"_output = ( texture2D( "+u.uuid+", vUv ).xyz * "+u.uuid+"_alpha );\n  /* custom_main */"),u.video=o,u.canvas=n,u.bypass=!1},u.update=function(){(u.bypass=!1)||(o.readyState!==o.HAVE_ENOUGH_DATA||o.seeking?(r.clearRect(0,0,1024,1024),u.alpha=0):(r.drawImage(o,0,0,1024,1024),i&&(i.needsUpdate=!0)))},u.render=function(){return i},u.src=function(e){u.currentSrc=e,o.src=e;var t=setInterval(function(){4==o.readyState&&(o.play(),console.log(u.uuid,"First Play."),clearInterval(t))},400)},u.play=function(){return o.play()},u.pause=function(){return o.pause()},u.paused=function(){return o.paused},u.currentTime=function(e){return void 0===e?o.currentTime:(console.log("set time",e),o.currentTime=e,e)},u.duration=function(){return o.duration},u.alpha=function(t){if(null==t)return e.customUniforms[u.uuid+"_alpha"].value;e.customUniforms[u.uuid+"_alpha"].value=t},u.jump=function(e){if(null==e||isNaN(e))try{o.currentTime=Math.floor(Math.random()*u.duration())}catch(e){console.log("prevented a race error")}else o.currentTime=e;return o.currentTime}}function WebcamSource(e,t){var n,o,r,i,u=this;null==t.uuid?u.uuid="WebcamSource_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):u.uuid=t.uuid,u.type="WebcamSource",u.bypass=!0,e.add(u);u.init=function(){console.log("init video source",u.uuid),(o=document.createElement("video")).setAttribute("crossorigin","anonymous"),o.height=1024,o.width=1024,o.loop=!0,o.load(),u.firstplay=!1;navigator.mediaDevices.getUserMedia({audio:!1,video:{width:1024,height:1024}}).then(function(e){o.srcObject=e,o.onloadedmetadata=function(e){o.play()}}).catch(function(e){console.log(e.name+": "+e.message)});var t=setInterval(function(){if(4==o.readyState){var e=Math.random()*o.duration;o.play(),u.firstplay=!0,console.log(u.uuid,"First Play; ",e),clearInterval(t)}},400);document.body.addEventListener("click",function(){o.play(),u.firstplay=!0}),o.volume=0,(n=document.createElement("canvas")).width=1024,n.height=1024,r=n.getContext("2d"),i=new THREE.Texture(n),e.customUniforms[u.uuid]={type:"t",value:i},e.customUniforms[u.uuid+"_alpha"]={type:"f",value:1},e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform sampler2D "+u.uuid+";\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec3 "+u.uuid+"_output;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform float "+u.uuid+"_alpha;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_main */","vec3 "+u.uuid+"_output = ( texture2D( "+u.uuid+", vUv ).xyz * "+u.uuid+"_alpha );\n  /* custom_main */"),u.video=o,u.canvas=n,u.bypass=!1},u.update=function(){(u.bypass=!1)||(o.readyState!==o.HAVE_ENOUGH_DATA||o.seeking?(r.clearRect(0,0,1024,1024),u.alpha=0):(r.drawImage(o,0,0,1024,1024),i&&(i.needsUpdate=!0)))},u.render=function(){return i},u.play=function(){return o.play()},u.pause=function(){return o.pause()},u.paused=function(){return o.paused},u.duration=function(){return o.duration},u.alpha=function(t){if(null==t)return e.customUniforms[u.uuid+"_alpha"].value;e.customUniforms[u.uuid+"_alpha"].value=t}}function Source(e,t){this.type="Source",this.function_list=[["JUMP","method","jump"]],this.init=function(){},this.update=function(){},this.render=function(){},this.start=function(){},this.src=function(e){},this.play=function(){},this.pause=function(){},this.paused=function(){},this.currentFrame=function(e){},this.duration=function(){},this.jump=function(){}}MidiController.prototype=new Midi,MidiController.constructor=MidiController,NumpadBpmMixerControl.prototype=new Controller,NumpadBpmMixerControl.constructor=NumpadBpmMixerControl,Midi.prototype=new Controller,Midi.constructor=Midi,Vidi.prototype=new Controller,Vidi.constructor=Vidi,GifSource.prototype=new Source,GifSource.constructor=GifSource,MultiVideoSource.prototype=new Source,MultiVideoSource.constructor=MultiVideoSource,SVGSource.prototype=new Source,SVGSource.constructor=SVGSource,SolidSource.prototype=new Source,SolidSource.constructor=SolidSource,TextSource.prototype=new Source,TextSource.constructor=TextSource,VideoSource.prototype=new Source,VideoSource.constructor=VideoSource,WebcamSource.prototype=new Source,WebcamSource.constructor=WebcamSource,function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.SuperGif=t()}(this,function(){var e=function(e){return e.reduce(function(e,t){return 2*e+t},0)},t=function(e){for(var t=[],n=7;n>=0;n--)t.push(!!(e&1<<n));return t},n=function(e){this.data=e,this.len=this.data.length,this.pos=0,this.readByte=function(){if(this.pos>=this.data.length)throw new Error("Attempted to read past end of stream.");return e instanceof Uint8Array?e[this.pos++]:255&e.charCodeAt(this.pos++)},this.readBytes=function(e){for(var t=[],n=0;n<e;n++)t.push(this.readByte());return t},this.read=function(e){for(var t="",n=0;n<e;n++)t+=String.fromCharCode(this.readByte());return t},this.readUnsigned=function(){var e=this.readBytes(2);return(e[1]<<8)+e[0]}},o=function(n,o){o||(o={});var r=function(e){for(var t=[],o=0;o<e;o++)t.push(n.readBytes(3));return t},i=function(){var e,t;t="";do{e=n.readByte(),t+=n.read(e)}while(0!==e);return t},u=function(u){u.leftPos=n.readUnsigned(),u.topPos=n.readUnsigned(),u.width=n.readUnsigned(),u.height=n.readUnsigned();var a=t(n.readByte());u.lctFlag=a.shift(),u.interlaced=a.shift(),u.sorted=a.shift(),u.reserved=a.splice(0,2),u.lctSize=e(a.splice(0,3)),u.lctFlag&&(u.lct=r(1<<u.lctSize+1)),u.lzwMinCodeSize=n.readByte();var c=i();u.pixels=function(e,t){for(var n,o,r=0,i=function(e){for(var n=0,o=0;o<e;o++)t.charCodeAt(r>>3)&1<<(7&r)&&(n|=1<<o),r++;return n},u=[],a=1<<e,c=a+1,s=e+1,d=[],l=function(){d=[],s=e+1;for(var t=0;t<a;t++)d[t]=[t];d[a]=[],d[c]=null};;)if(o=n,(n=i(s))!==a){if(n===c)break;if(n<d.length)o!==a&&d.push(d[o].concat(d[n][0]));else{if(n!==d.length)throw new Error("Invalid LZW code.");d.push(d[o].concat(d[o][0]))}u.push.apply(u,d[n]),d.length===1<<s&&s<12&&s++}else l();return u}(u.lzwMinCodeSize,c),u.interlaced&&(u.pixels=function(e,t){for(var n=new Array(e.length),o=e.length/t,r=function(o,r){var i=e.slice(r*t,(r+1)*t);n.splice.apply(n,[o*t,t].concat(i))},i=[0,4,2,1],u=[8,8,4,2],a=0,c=0;c<4;c++)for(var s=i[c];s<o;s+=u[c])r(s,a),a++;return n}(u.pixels,u.width)),o.img&&o.img(u)},a=function(){var r={};switch(r.sentinel=n.readByte(),String.fromCharCode(r.sentinel)){case"!":r.type="ext",function(r){switch(r.label=n.readByte(),r.label){case 249:r.extType="gce",function(r){n.readByte();var i=t(n.readByte());r.reserved=i.splice(0,3),r.disposalMethod=e(i.splice(0,3)),r.userInput=i.shift(),r.transparencyGiven=i.shift(),r.delayTime=n.readUnsigned(),r.transparencyIndex=n.readByte(),r.terminator=n.readByte(),o.gce&&o.gce(r)}(r);break;case 254:r.extType="com",function(e){e.comment=i(),o.com&&o.com(e)}(r);break;case 1:r.extType="pte",function(e){n.readByte(),e.ptHeader=n.readBytes(12),e.ptData=i(),o.pte&&o.pte(e)}(r);break;case 255:r.extType="app",function(e){switch(n.readByte(),e.identifier=n.read(8),e.authCode=n.read(3),e.identifier){case"NETSCAPE":!function(e){n.readByte(),e.unknown=n.readByte(),e.iterations=n.readUnsigned(),e.terminator=n.readByte(),o.app&&o.app.NETSCAPE&&o.app.NETSCAPE(e)}(e);break;default:!function(e){e.appData=i(),o.app&&o.app[e.identifier]&&o.app[e.identifier](e)}(e)}}(r);break;default:r.extType="unknown",function(e){e.data=i(),o.unknown&&o.unknown(e)}(r)}}(r);break;case",":r.type="img",u(r);break;case";":r.type="eof",o.eof&&o.eof(r);break;default:throw new Error("Unknown block: 0x"+r.sentinel.toString(16))}"eof"!==r.type&&setTimeout(a,0)};!function(){var i={};if(i.sig=n.read(3),i.ver=n.read(3),"GIF"!==i.sig)throw new Error("Not a GIF file.");i.width=n.readUnsigned(),i.height=n.readUnsigned();var u=t(n.readByte());i.gctFlag=u.shift(),i.colorRes=e(u.splice(0,3)),i.sorted=u.shift(),i.gctSize=e(u.splice(0,3)),i.bgColor=n.readByte(),i.pixelAspectRatio=n.readByte(),i.gctFlag&&(i.gct=r(1<<i.gctSize+1)),o.hdr&&o.hdr(i)}(),setTimeout(a,0)};return function(e){var t,r,i={vp_l:0,vp_t:0,vp_w:null,vp_h:null,c_w:null,c_h:null};for(var u in e)i[u]=e[u];i.vp_w&&i.vp_h&&(i.is_vp=!0);var a=null,c=!1,s=null,d=null,l=null,m=null,f=null,p=null,h=null,g=!0,v=!1,_=[],y=[],b=i.gif;void 0===i.auto_play&&(i.auto_play=!b.getAttribute("rel:auto_play")||"1"==b.getAttribute("rel:auto_play"));var S,w,x,E,M=i.hasOwnProperty("on_end")?i.on_end:null,T=i.hasOwnProperty("loop_delay")?i.loop_delay:0,C=i.hasOwnProperty("loop_mode")?i.loop_mode:"auto",A=!!i.hasOwnProperty("draw_while_loading")&&i.draw_while_loading,U=!!A&&(!i.hasOwnProperty("show_progress_bar")||i.show_progress_bar),B=i.hasOwnProperty("progressbar_height")?i.progressbar_height:25,k=i.hasOwnProperty("progressbar_background_color")?i.progressbar_background_color:"rgba(255,255,255,0.4)",z=i.hasOwnProperty("progressbar_foreground_color")?i.progressbar_foreground_color:"rgba(255,0,22,.8)",D=function(){s=null,d=null,f=l,l=null,p=null},I=function(){try{o(t,L)}catch(e){G("parse")}},P=function(e,t){S.width=e*W(),S.height=t*W(),x.style.minWidth=e*W()+"px",E.width=e,E.height=t,E.style.width=e+"px",E.style.height=t+"px",E.getContext("2d").setTransform(1,0,0,1,0,0)},N=function(e,t,n){if(n&&U){var o,r,u,a=B;i.is_vp?v?(r=(i.vp_t+i.vp_h-a)/W(),a/=W(),o=i.vp_l/W()+e/t*(i.vp_w/W()),u=S.width/W()):(r=i.vp_t+i.vp_h-a,a=a,o=i.vp_l+e/t*i.vp_w,u=S.width):(r=(S.height-a)/(v?W():1),o=e/t*S.width/(v?W():1),u=S.width/(v?W():1),a/=v?W():1),w.fillStyle=k,w.fillRect(o,r,u-o,a),w.fillStyle=z,w.fillRect(0,r,o,a)}},G=function(e){a=e,r={width:b.width,height:b.height},_=[],w.fillStyle="black",w.fillRect(0,0,i.c_w?i.c_w:r.width,i.c_h?i.c_h:r.height),w.strokeStyle="red",w.lineWidth=3,w.moveTo(0,0),w.lineTo(i.c_w?i.c_w:r.width,i.c_h?i.c_h:r.height),w.moveTo(0,i.c_h?i.c_h:r.height),w.lineTo(i.c_w?i.c_w:r.width,0),w.stroke()},O=function(){p&&(_.push({data:p.getImageData(0,0,r.width,r.height),delay:d}),y.push({x:0,y:0}))},R=function(){var e,t,n,o=-1,r=0,u=function(e){o+=e,s()},c=(e=!1,t=function(){null!==M&&M(b),r++,!1!==C||r<0?n():(e=!1,g=!1)},n=function(){if(e=g){u(1);var r=10*_[o].delay;r||(r=100),0==(o+1+_.length)%_.length?(r+=T,setTimeout(t,r)):setTimeout(n,r)}},function(){e||setTimeout(n,0)}),s=function(){var e;(o=parseInt(o,10))>_.length-1&&(o=0),o<0&&(o=0),e=y[o],E.getContext("2d").putImageData(_[o].data,e.x,e.y),w.globalCompositeOperation="copy",w.drawImage(E,0,0)};return{init:function(){a||(i.c_w&&i.c_h||w.scale(W(),W()),i.auto_play?c():(o=0,s()))},step:c,play:function(){g=!0,c()},pause:function(){g=!1},playing:g,move_relative:u,current_frame:function(){return o},length:function(){return _.length},move_to:function(e){o=e,s()}}}(),V=function(e){N(t.pos,t.data.length,e)},H=function(){},F=function(e,t){return function(n){e(n),V(t)}},L={hdr:F(function(e){P((r=e).width,r.height)}),gce:F(function(e){O(),D(),s=e.transparencyGiven?e.transparencyIndex:null,d=e.delayTime,l=e.disposalMethod}),com:F(H),app:{NETSCAPE:F(H)},img:F(function(e){p||(p=E.getContext("2d"));var t=_.length,n=e.lctFlag?e.lct:r.gct;t>0&&(3===f?null!==m?p.putImageData(_[m].data,0,0):p.clearRect(h.leftPos,h.topPos,h.width,h.height):m=t-1,2===f&&p.clearRect(h.leftPos,h.topPos,h.width,h.height));var o=p.getImageData(e.leftPos,e.topPos,e.width,e.height);e.pixels.forEach(function(e,t){e!==s&&(o.data[4*t+0]=n[e][0],o.data[4*t+1]=n[e][1],o.data[4*t+2]=n[e][2],o.data[4*t+3]=255)}),p.putImageData(o,e.leftPos,e.topPos),v||(w.scale(W(),W()),v=!0),A&&(w.drawImage(E,0,0),A=i.auto_play),h=e},!0),eof:function(e){O(),V(!1),i.c_w&&i.c_h||(S.width=r.width*W(),S.height=r.height*W()),R.init(),c=!1,X&&X(b)}},j=function(){b.parentNode;var e=document.createElement("div");S=document.createElement("canvas"),w=S.getContext("2d"),x=document.createElement("div"),E=document.createElement("canvas"),e.width=S.width=b.width,e.height=S.height=b.height,x.style.minWidth=b.width+"px",e.className="jsgif",x.className="jsgif_toolbar",e.appendChild(S),e.appendChild(x),i.c_w&&i.c_h&&P(i.c_w,i.c_h),q=!0},W=function(){return i.max_width&&r&&r.width>i.max_width?i.max_width/r.width:1},q=!1,X=!1,Q=function(e){return!c&&(X=e||!1,c=!0,_=[],D(),m=null,f=null,p=null,h=null,!0)};return{play:R.play,pause:R.pause,move_relative:R.move_relative,move_to:R.move_to,get_playing:function(){return g},get_canvas:function(){return S},get_canvas_scale:function(){return W()},get_loading:function(){return c},get_auto_play:function(){return i.auto_play},get_length:function(){return R.length()},get_current_frame:function(){return R.current_frame()},load_url:function(e,o){if(Q(o)){var r=new XMLHttpRequest;r.open("GET",e,!0),"overrideMimeType"in r?r.overrideMimeType("text/plain; charset=x-user-defined"):"responseType"in r?r.responseType="arraybuffer":r.setRequestHeader("Accept-Charset","x-user-defined"),r.onloadstart=function(){q||j()},r.onload=function(e){200!=this.status&&G("xhr - response"),"response"in this||(this.response=new VBArray(this.responseText).toArray().map(String.fromCharCode).join(""));var o=this.response;o.toString().indexOf("ArrayBuffer")>0&&(o=new Uint8Array(o)),t=new n(o),setTimeout(I,0)},r.onprogress=function(e){e.lengthComputable&&N(e.loaded,e.total,!0)},r.onerror=function(){G("xhr")},r.send()}},load:function(e){this.load_url(b.getAttribute("rel:animated_src")||b.src,e)},load_raw:function(e,o){Q(o)&&(q||j(),t=new n(e),setTimeout(I,0))},set_frame_offset:function(e,t){y[e]?(void 0!==t.x&&(y[e].x=t.x),void 0!==t.y&&(y[e].y=t.y)):y[e]=t}}}}),function(e,t){"function"==typeof define&&define.amd?define(["./libgif"],t):"object"==typeof exports?module.exports=t(require("./libgif")):e.RubbableGif=t(e.SuperGif)}(this,function(e){return function(t){var n=new e(t);return n.orig_load=n.load,n.load=function(e){n.orig_load(function(){var o,r,i,u,a,c,s,d;e&&e(),o=function(e){return t.vp_l?e-t.vp_l:e},r=n.get_canvas(),i=t.vp_w?t.vp_w:r.width,u=Math.floor(i/(2*n.get_length())),a=0,c=0,s="ontouchend"in document,d=0,r.addEventListener(s?"touchstart":"mousedown",function(e){e.preventDefault(),n.get_auto_play()&&n.pause();var t=e.touches&&e.touches.length>0?e.touches[0]:e,r=(t.layerX>0?o(t.layerX):i/2)/i;n.move_to(Math.floor(r*(n.get_length()-1))),c=e.timeStamp,a=o(t.pageX)}),r.addEventListener(s?"touchend":"mouseup",function(e){c=0,a=0,n.get_auto_play()&&n.play()}),r.addEventListener(s?"touchmove":"mousemove",function(e){e.preventDefault();var t=e.touches&&e.touches.length>0?e.touches[0]:e,r=o(t.pageX);currentDistance=0===a?0:Math.abs(r-a),currentTime=e.timeStamp,0!==c&&currentDistance>u&&(r<a&&n.get_current_frame()>0&&n.move_relative(-1),r>a&&n.get_current_frame()<n.get_length()-1&&n.move_relative(1),c=e.timeStamp,a=o(t.pageX)),e.timeStamp,d++,document.getElementById("tickles"+(d%5+1))&&document.getElementById("tickles"+(d%5+1)).play(),e.timeStamp})})},n}});