var GlRenderer=function(e){var t=this;t.options={element:"glcanvas"},null!=e&&(t.options=e),t.element=t.options.element,t.scene=new THREE.Scene,t.camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),t.camera.position.z=20,t.nodes=[],t.customUniforms={},t.customDefines={},t.vertexShader="\n    varying vec2 vUv;    void main() {      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );      vUv = uv;    }\n  ",t.fragmentShader="\n    uniform sampler2D textureTest;\n    uniform float wave;\n    /* custom_uniforms */    /* custom_helpers */    varying vec2 vUv;    void main() {      /* custom_main */    }\n  ",t.init=function(){console.log("init renderer"),t.glrenderer=new THREE.WebGLRenderer({canvas:glcanvas,alpha:!1}),t.nodes.forEach(function(e){e.init()}),t.shaderMaterial=new THREE.ShaderMaterial({uniforms:t.customUniforms,defines:t.customDefines,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,side:THREE.DoubleSide,transparent:!0}),t.flatGeometry=new THREE.PlaneGeometry(67,38),t.flatGeometry.translate(0,0,0),t.surface=new THREE.Mesh(t.flatGeometry,t.shaderMaterial),t.scene.add(t.surface)};Math.round(100*Math.random());t.render=function(){requestAnimationFrame(t.render),t.glrenderer.render(t.scene,t.camera),t.glrenderer.setSize(window.innerWidth,window.innerHeight),t.nodes.forEach(function(e){e.update()})},t.add=function(e){t.nodes.push(e)},t.dispose=function(){t.shaderMaterial,t.flatGeometry,t.scene.remove(t.surface),t.glrenderer.resetGLState(),t.customUniforms={},t.customDefines={},t.vertexShader="\n      varying vec2 vUv;\n      void main() {\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        vUv = uv;\n      }\n    ",t.fragmentShader="\n      uniform sampler2D textureTest;\n      ununiform float wave;\n      /* custom_uniforms */\n      /* custom_helpers */\n      varying vec2 vUv;\n      void main() {\n        /* custom_main */\n      }\n    ",t.nodes=[]}};function AudioAnalysis(e,t){var n=this;n.uuid="Analysis_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),n.type="Addon",n.audio="",n.bypass=!1,n.bpm=128,n.bpm_float=128,n.mod=1,n.bps=1,n.sec=0,n.options={audio:"/audio/fear_is_the_mind_killer_audio.mp3",microphone:!1},null!=t&&(n.options=t);var r=!0,o=[],u=0,c=(new Date).getTime();e.add(n);var i,a=new Audio,s=new AudioContext,d=s.createBiquadFilter(),l=s.createAnalyser(),f=Date.now();n.audio=a;var m,p=new Array(4e3),h=new Array(4e3),g=[],v=1,_=[];a.controls=!0,a.loop=!0,a.autoplay=!0,d.type="lowpass",d.frequency.value=350,d.Q.value=1,l.fftSize=128,m=l.frequencyBinCount;var b=function(){console.log("AudioAnalysis is re-intialized after click initialized!",a.src),a.play(),document.body.webkitRequestFullScreen(),document.body.removeEventListener("click",b)};document.body.addEventListener("click",b),n.disconnectOutput=function(){i.disconnect(s.destination)},n.connectOutput=function(){i.connect(s.destination)},n.getBpm=function(){return n.bpm},n.init=function(){console.log("init AudioAnalysis Addon."),n.options.microphone?navigator.mediaDevices.getUserMedia({audio:a}).then(function(e){i=s.createMediaStreamSource(e),y()}).catch(function(e){console.log(e.name+": "+e.message)}):(i=s.createMediaElementSource(a),a.src=n.options.audio,n.audio_src=n.options.audio,y())},n.update=function(){n.bypass||(n.disabled||o.forEach(function(e){e(n.render())}),n.bpm=n.tempodata_bpm,u=((new Date).getTime()-c)/1e3,n.sec=u*Math.PI*(n.bpm*n.mod)/60,n.bpm_float=(Math.sin(n.sec)+1)/2)},n.render=function(){return n.bpm_float},n.add=function(e){o.push(e)};var y=function(){a.play(),i.connect(d),d.connect(l),i.connect(s.destination),setInterval(S,1)};n.dataSet,n.tempoData;var S=function(){if(!n.audio.muted&&!n.bypass){var e=new Uint8Array(m);l.getByteTimeDomainData(e);var t=Date.now(),r=0;if(e.forEach(e=>{e>r&&(r=e)}),p.push([t,r]),p.length>4e3&&p.splice(0,p.length-4e3),0,t-f>100){var o=x(p);n.tempoData=o,null==o?console.log("sampler is active, but no beat was found"):n.tempodata_bpm=o.bpm,n.useAutoBPM&&(n.sec=u*Math.PI*(o.bpm*n.mod)/60),f=Date.now(),0}}},E=function(){0!=document.getElementsByClassName("blink").length&&(a.paused?document.getElementsByClassName("blink")[0].style.opacity=0:1==document.getElementsByClassName("blink")[0].style.opacity?document.getElementsByClassName("blink")[0].style.opacity=0:document.getElementsByClassName("blink")[0].style.opacity=1,setTimeout(E,60/n.bpm*1e3/n.mod))};E();var x=function(e){g=[],h=new Array(e.length);for(var t=0;t<e.length;t++)void 0!==e[t]&&e[t][1]>128*v&&(h[t]=[p[t][0],1],g.push([e[t][0],1]),t+=50);g.length<15&&(v-=.05),g.length>60&&(v+=.05),v>2&&(v=2),v<1&&(v=1);var n=T(M(g));if(n.sort(w),0==n.length)n[0]={tempo:0};else{var o="";n.reverse().forEach(function(e,t){o+=t+", "+e.tempo+", "+e.count+"\t [";for(var n=0;n<e.count;)o+="#",n++;o+="]<br/>"}),null!=document.getElementById("info")&&(document.getElementById("info").html=o)}var u="calibrating";if(r=!1,void 0===e[0])r=!0,document.getElementsByClassName("blink").length>0&&(document.getElementsByClassName("blink")[0].style.backgroundColor="#999999");else{if(r=!1,void 0===n[0]||void 0===n[1])return void console.log("holdit");var c=n[0].count-n[1].count;c<=2?(u="low",document.getElementsByClassName("blink").length>0&&(document.getElementsByClassName("blink")[0].style.backgroundColor="#990000")):c>2&&c<=7?(u="average",document.getElementsByClassName("blink").length>0&&(document.getElementsByClassName("blink")[0].style.backgroundColor="#999900")):c>7&&(u="high",document.getElementsByClassName("blink").length>0&&(document.getElementsByClassName("blink")[0].style.backgroundColor="#CCCCCC"))}return{bpm:n[0].tempo,confidence:u,calibrating:r,treshold:v,tempoCounts:n,foundpeaks:g,peaks:h}},w=function(e,t){return parseInt(e.count,10)-parseInt(t.count,10)},M=function(e){return _=[],e.forEach(function(t,n){for(var r=0;r<10;r++)if(void 0!==e[n+r]){var o=e[n+r][0]-t[0];_.some(function(e){if(e.interval===o)return e.count++})||_.push({interval:o,count:1})}}),_},T=function(e){var t=[];return e.forEach(function(e,n){if(0!=e.interval&&!isNaN(e.interval))var r=60/(e.interval/1e3);for(;r<90;)r*=2;for(;r>180;)r/=2;r=2*Math.round(r/2),t.some(function(t){if(t.tempo===r)return t.count+=e.count})||r&&t.push({tempo:r,count:e.count})}),t}}function BPM(e,t){var n=this;if(n.function_list=[["AUTO","method","toggleAutoBpm"],["MODDOWN","method","modDown"],["MODUP","method","modUp"],["MOD","method","modNum"]],null!=e){n.uuid="BPM_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),window["bpm_"+n.uuid],n.type="Addon",n.options={},null!=t&&(n.options=t),n.bpm=128,n.bps=2.133333,n.sec=0,n.bpm_float=.46875,n.mod=1,n.useAutoBpm=!1,n.tempodata_bpm=128,n.mute=!1,n.autoBpmData={},n.audio_src="",n.useMicrophone=!1,n.bypass=!1;var r=[],o=0;e.add(n),n.init=function(){console.log("init BPM contoller.")};var u=(new Date).getTime();n.update=function(){n.bypass||(n.disabled||r.forEach(function(e){e(n.render())}),o=((new Date).getTime()-u)/1e3,n.sec=o*Math.PI*(n.bpm*n.mod)/60,n.bpm_float=(Math.sin(n.sec)+1)/2)},n.add=function(e){r.push(e)},n.render=function(){return n.bpm_float},n.modUp=function(){n.mod*=2},n.modDown=function(){n.mod*=.5},n.modNum=function(e){console.log("MOD ",e);var t=n.useAutoBpm;n.mod=e,n.useAutoBpm=t},n.toggleAutoBpm=function(e){n.useAutoBpm=!n.useAutoBpm,console.log("---\x3e",n.useAutoBpm)},n.turnOff=function(){bpm.audio.muted=!1,bpm.useAutoBpm=!1};var c=Number(new Date),i=[128,128,128,128,128],a=0,s=0;n.tap=function(){n.useAutoBPM=!1,a=Number(new Date)-c,c=Number(new Date),a<1e4&&a>10&&(i.splice(0,1),i.push(6e4/a),s=i.reduce(function(e,t){return e+t})/i.length,n.bpm=s,n.bps=s/60)},n.getBpm=function(){return n.bpm},console.log("set keypress"),window.addEventListener("keypress",function(e){console.log(">>> ",e.which),116!=e.which&&32!=e.which||(n.tap(),console.log(n.bpm))})}}function FileManager(e){var t=this;try{renderer}catch(e){return void(t.function_list=[["CHANGE","method","changez"],["POD","set","pod"]])}t.uuid="Filemanager_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),t.type="AddOn",t.defaultQuality="",t.source=e,t.set=[],t.file,t.renderer=renderer,t.load_set=function(e){(new Utils).get(e,function(e){console.log("--\x3e",e),t.set=JSON.parse(e)})},t.setSrc=function(e){console.log("set source: ",e),t.source.src(e)},t.getFileById=function(e){},t.getSrcByTags=function(e){if(0==programs.length)return"no programs";var n=[];if(programs.forEach(function(t,r){e.forEach(function(e,r){t.tags.includes(e)&&null!=t.assets&&"Video"==t.assets._type&&n.push(t)})}),0==n.length)return"no matches";var r=n[Math.floor(Math.random()*n.length)];console.log(">> ",n.length,r.title),t.setSrc(t.getSrcByQuality(r))},t.load=function(e){utils.get(e,function(e){console.log("got:",JSON.parse(e)),t.set=JSON.parse(e)})},t.change=function(e){if(0!=t.set.length){var n=t.set[Math.floor(Math.random()*t.set.length)];console.log("from set:",n),t.setSrc(n)}},t.changez=function(e){t.change(e)},t.getSrcByQuality=function(e,t){null==t&&(t="720p_h264");var n=null;return e.assets.versions.forEach(function(e){e.label==t&&(n=e)}),n.url}}function GiphyManager(e){var t=this;t.uuid="GiphyManager_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),t.type="AddOn",t.source=e,t.file,t.programs,t.program,t.renderer=renderer;t.needle=function(e){utils.get("//api.giphy.com/v1/gifs/search?api_key=tIovPHdiZhUF3w0UC6ETdEzjYOaFZQFu&q="+e,function(e){t.programs=e.data,console.log(" === GIPHY (re)LOADED === ")})},t.search=function(e){t.needle(e)},t.setSrc=function(e){console.log("set source: ",e),t.source.src(e)},t.change=function(){if(0==t.programs.length)return"no programs";t.program=t.programs[Math.floor(Math.random()*t.programs.length)],t.setSrc(t.program.images.original.url)},t.changez=function(){t.change()},t.needle("vj")}function Addon(){}function ComputerKeyboard(){}function Gamepad(){}function Behaviour(e,t){var n=this;function r(e){"seconds"==e.mod.type?triggers.push([e,n.time+e.mod.value,null]):"beats"==e.mod.type?triggers.push([e,n.beats+e.mod.value]):"random-seconds"==e.mod.type?triggers.push([e,n.time+Math.random()*e.mod.value,null]):"random-beats"==e.mod.type&&triggers.push([e,n.beats+Math.random()*e.mod.value])}n.uuid="Behaviour"+(4294967296*(1+Math.random())|0).toString(16).substring(1),n.type="Behaviour",e.add(n),n.beats=0,n.time=(new Date).getTime(),n.script={},n.sheets=[],n.sheet_index=0,n.bpm=t.bpm,triggers=[],n.tr=triggers,old_bpm=1,n.init=function(){},n.update=function(){n.time=(new Date).getTime();var e=Math.round(4*bpm.render());e!=old_bpm&&(n.beats+=1,old_bpm=e)},n.load=function(e){n.script=e,n.sheets=e.sheets,console.log("loaded A BEHAVIOUR",e.title),e.triggers.forEach(function(e,t){r(e)})},n.jump=function(e){console.log("how high?",e),e.video.currentTime=Math.random()*e.video.duration};var o=0;n.checkSheets=function(){n.sheets[0].length;checkBeats(o%n.sheets[n.sheet_index].length),n.sheets[n.sheet_index][o%n.sheets[n.sheet_index].length].forEach(function(e){if("....."!=e[0]){console.log(e);var t=n.script.composition[e[0]].target,r=n.script.composition[e[0]].functions,o=null;r.forEach(function(n,r){if(e[1]==n[0]){console.log("TRIGGERED",o=n[2]);var u=e[2];u=isNaN(e[2])?e[2]:parseFloat(e[2]),t[n[2]](u),console.log(t,o,u)}})}}),o+=1,setTimeout(n.checkSheets,60/bpm.bpm*1e3/4)};setTimeout(function(){},12e3)}function FireBaseControl(e,t,n,r){this.uuid="FireBaseControl_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),this.type="Control",this.clients={},this.bypass=!0;var o,u,c=[],i=[];e.add(this);var a=0,s=0;this.init=function(){console.log("init FireBase contoller.");var e;firebase.initializeApp({apiKey:"AIzaSyDgrYfOUDN1QLRDcY4z45WwkcOjkXiImNQ",authDomain:"mixerbase-829c2.firebaseapp.com",databaseURL:"https://mixerbase-829c2.firebaseio.com",storageBucket:"mixerbase-829c2.appspot.com",messagingSenderId:"568387460963"}),o=firebase.database(),"/client_1/",u=o.ref("/client_1/"),[],u.on("value",function(e){}),u.child("gamepad/leftx").on("value",function(e){a=e.val(),d(a,s)}),u.child("gamepad/lefty").on("value",function(e){s=e.val(),d(a,s)}),u.child("gamepad/button_1").on("value",function(t){clearTimeout(e),e=setTimeout(function(){giphymanager1.change()},200)}),u.child("gamepad/button_2").on("value",function(t){clearTimeout(e),e=setTimeout(function(){filemanager2.change()},200)}),u.child("gamepad/button_3").on("value",function(t){clearTimeout(e),e=setTimeout(function(){filemanager3.change()},200)}),u.child("gamepad/button_4").on("value",function(t){clearTimeout(e),e=setTimeout(function(){filemanager4.change()},200)});for(var t=0;t<17;)u.child("mobilepad/button_"+t).on("value",function(e){console.log("i click you",t,e.key)}),t++},this.update=function(){},this.render=function(){},this.addMixer=function(e){c.push(e)},this.addFileManager=function(e){i.push(e)};var d=function(e,o){console.log("update mixers"),t.pod(e/2+.5),n.pod(e/2+.5),r.pod(o/2+.5)}}function GamePadController(e,t,n,r){var o=this;o.uuid="GamePadController_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),o.type="Control",o.controllers={},o.bypass=!0;var u,c,i,a,s=[];e.add(o),o.init=function(){console.log("init GamePadController."),window.addEventListener("GamePadController connected",d)},o.update=function(){if(!o.bypass){navigator.getGamePadControllers()[0].buttons;navigator.getGamePadControllers()[0].buttons.forEach(function(e,t){e.pressed&&(console.log(" i press you ",t,e),0==t&&(clearTimeout(u),u=setTimeout(function(){filemanager1.change()},200)),1==t&&(clearTimeout(c),c=setTimeout(function(){filemanager2.change()},200)),2==t&&(clearTimeout(i),i=setTimeout(function(){filemanager3.change()},200)),3==t&&(clearTimeout(a),a=setTimeout(function(){filemanager4.change()},200)))});var e=navigator.getGamePadControllers()[0].axes,s=e[0],d=e[1];e[5],e[6],e[9];t.pod(s/2+.5),n.pod(s/2+.5),r.pod(d/2+.5)}},o.add=function(e){s.push(e)},o.render=function(){return o.controllers};var d=function(e){var t;console.log("GamePadController connected at index %d: %s. %d buttons, %d axes.",e.GamePadController.index,e.GamePadController.id),t=e.GamePadController,o.controllers[t.index]=t,console.log(t.id,t.index),o.bypass=!1}}function MidiController(e){var t=this;t.uuid="MidiController_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),t.type="MidiController",t.bypass=!0,t.verbose=!1,t.ready=!1,t.controllers={};var n,r,u=[],c=[];function a(){t.verbose&&console.log(" MIDI READY","ready"),d("ready")}console.log("Midi check... "),navigator.requestMIDIAccess&&navigator.requestMIDIAccess().then(function(e){var u=(n=e).inputs.values(),c=n.outputs.values();for(i=u.next();i&&!i.done;i=u.next())i.value.onmidimessage=t.onMIDIMessage;for(o=c.next();o&&!o.done;o=c.next())r=o.value,a();console.log("Midi READY"),null!=r&&(t.ready=!0)},function(){console.error("No access to your midi devices.")});t.onMIDIMessage=function(e){t.verbose&&console.log(" MIDIMESSAGE >>",e.data),s(e.data),d(e)},t.init=function(){},t.update=function(){},t.bind=function(e,t){c.push({key:e,callback:t})},t.removeBind=function(e,t){};var s=function(e){c.forEach(function(t){e[1]==t.key&&t.callback(e)})};t.send=function(e){t.ready?(console.log("Midi send ",e,"to",r),r.send(e)):console.log("Midi is not ready yet")},t.addEventListener=function(e,t){console.log("midi add listener: ",e),u.push({callbackName:e,target:t}),console.log("midi list: ",u)};var d=function(e){u.forEach(function(t){t.target[t.callbackName](e)})}}function NumpadBpmMixerControl(e,t,n){this.uuid="NumpadBpmMixer_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),this.type="Control",this.controllers={};var r=[],o=[];e.add(this),this.init=function(){window.addEventListener("keydown",a),window.addEventListener("keyup",s)},this.update=function(){},this.render=function(){},this.addMixer=function(e){o.push(e)},this.addBpm=function(e){r.push(e)};var u,c=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18],i=[1,2,3,4,5,6,7,8,9];document.body.addEventListener("click",function(){r.forEach(function(e){e.tap()})});var a=function(e){console.log("had key: ",e.which),[[109,function(){r.forEach(function(e){e.bpm-=1})}],[107,function(){r.forEach(function(e){e.bpm+=1})}],[106,function(){r.forEach(function(e){e.bpm*=2})}],[111,function(){r.forEach(function(e){e.bpm*=.5})}],[101,function(){r.forEach(function(e){e.tap()})}],[96,function(){switcher1.doSwitch(0)}],[110,function(){switcher1.doSwitch(1)}],[75,function(){switcher1.doSwitch(0)}],[76,function(){switcher1.doSwitch(1)}],[66,function(){r.forEach(function(e){e.tap()})}],[32,function(){r.forEach(function(e){e.tap()})}],[81,function(){clearTimeout(u),u=setTimeout(function(){giphymanager1.change()},200)}],[87,function(){clearTimeout(u),u=setTimeout(function(){filemanager2.change("awesome")},200)}],[69,function(){clearTimeout(u),u=setTimeout(function(){filemanager3.change("runner")},200)}],[82,function(){clearTimeout(u),u=setTimeout(function(){filemanager4.change()},200)}],[65,function(){giphymanager1.source.currentFrame(Math.floor(Math.random()*giphymanager1.source.duration()))}],[83,function(){filemanager2.source.currentTime(Math.floor(Math.random()*filemanager2.source.duration()))}],[68,function(){filemanager3.source.currentTime(Math.floor(Math.random()*filemanager3.source.duration()))}],[188,function(){mixer3.pod(mixer3.pod()-.1)}],[190,function(){mixer3.pod(mixer3.pod()+.1)}],[104,function(){o.forEach(function(e){e.blendMode(1),e.mixMode(1),c=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18],i=[1,2,3,4,5,6,7,8,9]})}],[103,function(){c.unshift(c.pop()),o.forEach(function(e){e.blendMode(c[0])})}],[105,function(){c.push(c.shift()),o.forEach(function(e){e.blendMode(c[0])})}],[100,function(){i.unshift(i.pop()),o.forEach(function(e){e.mixMode(i[0])})}],[102,function(){i.push(i.shift()),o.forEach(function(e){e.mixMode(i[0])})}],[97,function(){console.log("mix trans left, down")}],[99,function(){console.log("mmix trans right, down")}]].forEach(function(r){r[0]==e.which&&(r[1](),console.log("numpad Handled key DOWN",r[0],n.bpm,t.mixMode(),t.blendMode()))})},s=function(e){[[97,function(){console.log("mix trans left, up")}],[99,function(){console.log("mmix trans right, up")}]].forEach(function(r){r[0]==e.which&&(r[1](),console.log("numpad Handled key UP",r[0],n.bpm,t.mixMode(),t.blendMode()))})}}function SourceControl(e,t){}function Controller(e){this.type="Controller",this.testControllerVar="test",this.init=function(){},this.update=function(){},this.render=function(){},this.add=function(){}}function ColorEffect(e,t){var n=this;null==t.uuid?n.uuid="ColorEffect_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):n.uuid=t.uuid,e.add(n),n.type="Effect";var r,o=t.source,u=t.effect,c=(u=1,.8),i=128*window.devicePixelRatio;new Uint8Array(i*i*3);n.init=function(){(r=document.createElement("canvas")).width=1024,r.height=1024,canvasElementContext=r.getContext("2d"),canvasElementContext.fillStyle="#FF0000",canvasElementContext.fillRect(0,0,500,500),console.log("ColorEffect inits, with",e),e.customUniforms[n.uuid+"_currentcoloreffect"]={type:"i",value:1},e.customUniforms[n.uuid+"_extra"]={type:"f",value:2},e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec4 "+n.uuid+"_output;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform int "+n.uuid+"_currentcoloreffect;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform float "+n.uuid+"_extra;\n/* custom_uniforms */"),-1==renderer.fragmentShader.indexOf("vec4 coloreffect ( vec4 src, int currentcoloreffect, float extra, vec2 vUv )")&&(e.fragmentShader=e.fragmentShader.replace("/* custom_helpers */","\nvec4 coloreffect ( vec4 src, int currentcoloreffect, float extra, vec2 vUv ) {\n  if ( currentcoloreffect == 1 ) return vec4( src.rgba );                                                                               // normal\n\n  // negative\n  if ( currentcoloreffect == 2  ) return vec4( 1.-src.r, 1.-src.g, 1.-src.b, src.a );                                                   // negtive 1\n  if ( currentcoloreffect == 3  ) return vec4( 1./src.r-1.0, 1./src.g-1.0, 1./src.b-1.0, src.a );                                       // negtive 2\n  if ( currentcoloreffect == 4  ) return vec4( 1./src.r-2.0, 1./src.g-2.0, 1./src.b-2.0, src.a );                                       // negtive 3\n\n  // monocolor\n  if ( currentcoloreffect == 5  ) return vec4( vec3( src.r + src.g + src.b ) / 3., src.a );                                             // black and white\n  if ( currentcoloreffect == 6  ) return vec4( vec3( (src.r+src.g+src.b) *3.  , (src.r+src.g+src.b)  /1.7 , (src.r+src.g+src.b) /1.7 ) / 3., src.a );  // mopnocolor red\n  if ( currentcoloreffect == 7  ) return vec4( vec3( (src.r+src.g+src.b) /1.7 , (src.r+src.g+src.b)  *3.  , (src.r+src.g+src.b) /1.7 ) / 3., src.a );  // mopnocolor blue\n  if ( currentcoloreffect == 8  ) return vec4( vec3( (src.r+src.g+src.b) /1.7 , (src.r+src.g+src.b)  /1.7 , (src.r+src.g+src.b) *3.  ) / 3., src.a );  // mopnocolor green\n  if ( currentcoloreffect == 9  ) return vec4( vec3( (src.r+src.g+src.b) *2.  , (src.r+src.g+src.b)  *2.  , (src.r+src.g+src.b) /1.2 ) / 3., src.a );  // mopnocolor yellow\n  if ( currentcoloreffect == 10 ) return vec4( vec3( (src.r+src.g+src.b) *1.2 , (src.r+src.g+src.b)  *2.  , (src.r+src.g+src.b) *2.  ) / 3., src.a );  // mopnocolor turqoise\n  if ( currentcoloreffect == 11 ) return vec4( vec3( (src.r+src.g+src.b) *2.  , (src.r+src.g+src.b)  /1.2 , (src.r+src.g+src.b) *2.  ) / 3., src.a );  // mopnocolor purple\n  if ( currentcoloreffect == 12 ) return vec4( vec3( src.r + src.g + src.b ) / 3. * vec3( 1.2, 1.0, 0.8 ), src.a);                                   // sepia\n\n  // color swapping\n  if ( currentcoloreffect == 13 ) return vec4( src.rrra );\n  if ( currentcoloreffect == 14 ) return vec4( src.rrga );\n  if ( currentcoloreffect == 15 ) return vec4( src.rrba );\n  if ( currentcoloreffect == 16 ) return vec4( src.rgra );\n  if ( currentcoloreffect == 17 ) return vec4( src.rgga );\n  if ( currentcoloreffect == 18 ) return vec4( src.rbra );\n  if ( currentcoloreffect == 19 ) return vec4( src.rbga );\n  if ( currentcoloreffect == 20 ) return vec4( src.rbba );\n  if ( currentcoloreffect == 21 ) return vec4( src.grra );\n  if ( currentcoloreffect == 22 ) return vec4( src.grga );\n  if ( currentcoloreffect == 23 ) return vec4( src.grba );\n  if ( currentcoloreffect == 24 ) return vec4( src.ggra );\n  if ( currentcoloreffect == 25 ) return vec4( src.ggga );\n  if ( currentcoloreffect == 26 ) return vec4( src.ggba );\n  if ( currentcoloreffect == 27 ) return vec4( src.gbra );\n  if ( currentcoloreffect == 28 ) return vec4( src.gbga );\n  if ( currentcoloreffect == 29 ) return vec4( src.gbba );\n  if ( currentcoloreffect == 30 ) return vec4( src.brra );\n  if ( currentcoloreffect == 31 ) return vec4( src.brga );\n  if ( currentcoloreffect == 32 ) return vec4( src.brba );\n  if ( currentcoloreffect == 33 ) return vec4( src.bgra );\n  if ( currentcoloreffect == 34 ) return vec4( src.bgga );\n  if ( currentcoloreffect == 35 ) return vec4( src.bgba );\n  if ( currentcoloreffect == 36 ) return vec4( src.bbra );\n  if ( currentcoloreffect == 37 ) return vec4( src.bbga );\n  if ( currentcoloreffect == 38 ) return vec4( src.bbba );\n\n  // lum key\n  if ( currentcoloreffect == 39 ) {\n    float red = clamp( src.r, extra, 1.) == extra ? .0 : src.r;\n    float green = clamp( src.r, extra, 1.) == extra ? .0 : src.g;\n    float blue = clamp( src.r, extra, 1.) == extra ? .0 : src.b;\n    float alpha = red + green + blue == .0 ? .0 : src.a;\n    return vec4( red, green, blue, alpha );\n  }\n\n  // color key; Greenkey\n  if ( currentcoloreffect == 40 ) {\n    return vec4( src.r, clamp( src.r, extra, 1.) == extra ? .0 : src.g, src.b, clamp( src.r, extra, 1.) == extra ? .0 : src.a );\n  }\n\n  // paint\n  if ( currentcoloreffect == 41 ) {\n    return vec4( floor( src.r * extra ) / extra, floor( src.g * extra ) / extra, floor( src.b * extra ) / extra, src.a  );\n  }\n\n  // colorise\n  if ( currentcoloreffect == 42 ) {\n  }\n\n  // wipes (move these to mixer?)\n  if ( gl_FragCoord.x > 200.0 ) {\n    return vec4(0.0,0.0,0.0,0.0);\n  }else {\n    return src;\n  }\n}\n\n/* custom_helpers */\n")),e.fragmentShader=e.fragmentShader.replace("/* custom_main */","vec4 "+n.uuid+"_output = coloreffect( "+o.uuid+"_output, "+n.uuid+"_currentcoloreffect, "+n.uuid+"_extra, vUv );\n  /* custom_main */")};new THREE.Vector2;n.update=function(){0,glcanvas=document.getElementById("glcanvas"),canvasElementContext.drawImage(glcanvas,0,0,glcanvas.width,glcanvas.height)},n.effect=function(e){return null!=e&&(u=e,renderer.customUniforms[n.uuid+"_currentcoloreffect"].value=u),console.log("effect set to: ",u),u},n.extra=function(e){return null!=e&&(c=e,renderer.customUniforms[n.uuid+"_extra"].value=c),console.log("extra set to: ",c),c}}function DistortionEffect(e,t){var n=this;null==t.uuid?n.uuid="DistortionEffect_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):n.uuid=t.uuid,e.add(n),n.type="Effect";var r=t.source,o=t.effect;o=12;n.update=function(){i+=.001,renderer.customUniforms[r.uuid+"_uvmap_mod"]={type:"v2",value:new THREE.Vector2(i,Math.cos(i))},renderer.customUniforms[r.uuid+"_uvmap"]={type:"v2",value:new THREE.Vector2(1-.82*Math.random(),1-.82*Math.random())}},n.effect=function(e){return null!=e&&(o=e,renderer.customUniforms[n.uuid+"_currentdistortioneffect"].value=o),o}}function FeedbackEffect(e,t){var n=this;null==t.uuid?n.uuid="FeedbackEffect_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):n.uuid=t.uuid,e.add(n),n.type="Effect";var r,o,u=t.source,c=t.effect,i=(c=12,128*window.devicePixelRatio);new Uint8Array(i*i*3);n.init=function(){(r=document.createElement("canvas")).width=1024,r.height=1024,canvasElementContext=r.getContext("2d"),canvasElementContext.fillStyle="#FF0000",canvasElementContext.fillRect(0,0,500,500),console.log("FeedbackEffect inits, with",e),(o=new THREE.Texture(r)).wrapS=THREE.RepeatWrapping,o.wrapT=THREE.RepeatWrapping,o.repeat.set(4,4),e.customUniforms[n.uuid+"_effectsampler"]={type:"t",value:o},e.customUniforms[n.uuid+"_currentfeedbackeffect"]={type:"i",value:100},e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec4 "+n.uuid+"_output;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform sampler2D  "+n.uuid+"_effectsampler;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform int  "+n.uuid+"_currentfeedbackeffect;\n/* custom_uniforms */"),-1==renderer.fragmentShader.indexOf("vec4 feedbackeffect ( vec4 src, int currentfeedbackeffect, vec2 vUv )")&&(e.fragmentShader=e.fragmentShader.replace("/* custom_helpers */","\n  vec4 feedbackeffect ( vec4 src, int currentfeedbackeffect, vec2 vUv ) {\n    if ( currentfeedbackeffect == 100 ) {\n      //vec4 inbetween = vec4( src.r, src.g, src.b, vUv * 0.9. );\n      //gl_Position = vec4( vec2(0.,0.), 0., 0.);\n      //return inbetween.rrr;\n      // return src;\n      return ( texture2D( "+n.uuid+"_effectsampler, vUv + vec2( 1., 0.99999999) ).rgb ) + src * 0.3;\n      // return ( texture2D( "+n.uuid+"_effectsampler, vUv  ).rgb * 1.4 + src * .8) * 0.5; //* vec3(.5, .5, .5\n      // return ( texture2D( src, vUv ).rgb );\n      // return ( texture2D( "+n.uuid+"_effectsampler, vUv  ).rgb ) * src + src;\n\n      vec4 tex = texture2D( "+n.uuid+"_effectsampler, vUv * 2. ); //+ vec4( src.r, src.g, src.b, vUv * 2. );\n\n      // return src.rrr;\n      // tex.rgb = vec3(src.r, src.g, src.b);\n      // tex.xy = vec2(1.0,1.0);\n      // tex = tex + vec4( src.r, src.g, src.b, vUv * 2. );\n\n\n      // * 0.52 + vec4( src * 0.52, vUv ) *\n      // vec4 tex = vec4( src, vUv * .5 );\n      // return mix( tex, "+n.uuid+"_effectsampler, 0.).rgb;\n      //return mix(tex.rgb, src.rgb, 1.);\n    }\n\n    // uniform float noiseScale;\n    // uniform float time;\n    // uniform float baseSpeed;\n    // uniform sampler2D noiseTexture;\n\n    if ( currentfeedbackeffect == 101 ) {\n      // vec2 uvTimeShift = vUv + vec2( -0.7, 1.5 ) * time * baseSpeed;\n      // vec4 noiseGeneratorTimeShift = texture2D( noiseTexture, uvTimeShift );\n      // vec2 uvNoiseTimeShift = vUv + noiseScale * vec2( noiseGeneratorTimeShift.r, noiseGeneratorTimeShift.a );\n\n      // _effectsampler\n      // return  vec4 texture2D( baseTexture1, uvNoiseTimeShift )\n\n      // https://stackoverflow.com/questions/19872524/threejs-fragment-shader-using-recycled-frame-buffers\n      // http://labs.sense-studios.com/webgl/index4.html?r=sdad\n\n      // return _effectsampler.rgb\n      return src;\n    }\n\n    return src;\n  }\n")),e.fragmentShader=e.fragmentShader.replace("/* custom_main */","vec4 "+n.uuid+"_output = feedbackeffect( "+u.uuid+"_output, "+n.uuid+"_currentfeedbackeffect, vUv );\n  /* custom_main */")};new THREE.Vector2;n.update=function(){0,glcanvas=document.getElementById("glcanvas"),canvasElementContext.drawImage(glcanvas,0,0,glcanvas.width,glcanvas.height),o&&(o.needsUpdate=!0)},n.effect=function(e){return null!=e&&(c=e,renderer.customUniforms[n.uuid+"_currentfeedbackeffect"].value=c),c}}function Effect(e,t){this.type="Effect",this.init=function(){},this.update=function(){},this.render=function(){}}function Chain(e,t){var n,r=this;null==t.uuid?r.uuid="Chain_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):r.uuid=t.uuid,e.add(r),null!=t&&(n=t),r.type="Module",r.sources=n.sources,r.sources.forEach(function(t,n){e.customUniforms[r.uuid+"_source"+n+"_alpha"]={type:"f",value:.5}}),r.sources.forEach(function(t,n){e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform float "+r.uuid+"_source"+n+"_alpha;\n/* custom_uniforms */")}),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform float "+r.uuid+"_alpha;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec3 "+r.uuid+"_output;\n/* custom_uniforms */"),r.init=function(){var t="vec4(0.0,0.0,0.0,0.0)";r.sources.forEach(function(e,n){t+=" + ("+e.uuid+"_output * "+r.uuid+"_source"+n+"_alpha )"}),e.fragmentShader=e.fragmentShader.replace("/* custom_main */","vec4 "+r.uuid+"_output = vec4( "+t+"); /* custom_main */")},r.update=function(){},r.setChainLink=function(t,n){e.customUniforms[r.uuid+"_source"+t+"_alpha"].value=n},r.getChainLink=function(e){return r.sources(e)},r.setAll=function(t=0){r.sources.forEach(function(n,o){e.customUniforms[r.uuid+"_source"+o+"_alpha"].value=t})},r.toggle=function(t,n){void 0===n?1==e.customUniforms[r.uuid+"_source"+t+"_alpha"].value?e.customUniforms[r.uuid+"_source"+t+"_alpha"].value=0:(e.customUniforms[r.uuid+"_source"+t+"_alpha"].value=1,current=t):e.customUniforms[r.uuid+"_source"+t+"_alpha"].value=n}}function Mixer(e,t){var n=this;if(n.function_list=[["BLEND","method","blendMode"],["MIX","method","mixMode"],["POD","set","pod"]],null!=e){null==t.uuid?n.uuid="Mixer_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):n.uuid=t.uuid,e.add(n),null!=t&&t,n.type="Module";var r=1,o=0,u=0,c=128,i=1,a=function(){return c};n.autoFade=!1;var s=1;n.mixmodes=[1,2,3,4,5,6,7,8,9];var d,l,f=1;n.blendmodes=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18],d=t.source1,l=t.source2,n.init=function(){e.customUniforms[n.uuid+"_mixmode"]={type:"i",value:1},e.customUniforms[n.uuid+"_blendmode"]={type:"i",value:1},e.customUniforms[n.uuid+"_alpha1"]={type:"f",value:.5},e.customUniforms[n.uuid+"_alpha2"]={type:"f",value:.5},e.customUniforms[n.uuid+"_sampler"]={type:"t",value:null},e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform int "+n.uuid+"_mixmode;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform int "+n.uuid+"_blendmode;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform float "+n.uuid+"_alpha1;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform float "+n.uuid+"_alpha2;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec4 "+n.uuid+"_output;\n/* custom_uniforms */"),-1==e.fragmentShader.indexOf("vec4 blend ( vec4 src, vec4 dst, int blendmode )")&&(e.fragmentShader=e.fragmentShader.replace("/* custom_helpers */","\nvec4 blend ( vec4 src, vec4 dst, int blendmode ) {\n  if ( blendmode ==  1 ) return src + dst;\n  if ( blendmode ==  2 ) return src - dst;\n  if ( blendmode ==  3 ) return src * dst;\n  if ( blendmode ==  4 ) return min(src, dst);\n  if ( blendmode ==  5)  return vec4((src.x == 0.0) ? 0.0 : (1.0 - ((1.0 - dst.x) / src.x)), (src.y == 0.0) ? 0.0 : (1.0 - ((1.0 - dst.y) / src.y)), (src.z == 0.0) ? 0.0 : (1.0 - ((1.0 - dst.z) / src.z)),1.0);\n  if ( blendmode ==  6 ) return (src + dst) - 1.0;\n  if ( blendmode ==  7 ) return max(src, dst);\n  if ( blendmode ==  8 ) return (src + dst) - (src * dst);\n  if ( blendmode ==  9 ) return vec4((src.x == 1.0) ? 1.0 : min(1.0, dst.x / (1.0 - src.x)), (src.y == 1.0) ? 1.0 : min(1.0, dst.y / (1.0 - src.y)), (src.z == 1.0) ? 1.0 : min(1.0, dst.z / (1.0 - src.z)), 1.0);\n  if ( blendmode == 10 ) return src + dst;\n  if ( blendmode == 11 ) return vec4((dst.x <= 0.5) ? (2.0 * src.x * dst.x) : (1.0 - 2.0 * (1.0 - dst.x) * (1.0 - src.x)), (dst.y <= 0.5) ? (2.0 * src.y * dst.y) : (1.0 - 2.0 * (1.0 - dst.y) * (1.0 - src.y)), (dst.z <= 0.5) ? (2.0 * src.z * dst.z) : (1.0 - 2.0 * (1.0 - dst.z) * (1.0 - src.z)), 1.0);\n  if ( blendmode == 12 ) return vec4((src.x <= 0.5) ? (dst.x - (1.0 - 2.0 * src.x) * dst.x * (1.0 - dst.x)) : (((src.x > 0.5) && (dst.x <= 0.25)) ? (dst.x + (2.0 * src.x - 1.0) * (4.0 * dst.x * (4.0 * dst.x + 1.0) * (dst.x - 1.0) + 7.0 * dst.x)) : (dst.x + (2.0 * src.x - 1.0) * (sqrt(dst.x) - dst.x))), (src.y <= 0.5) ? (dst.y - (1.0 - 2.0 * src.y) * dst.y * (1.0 - dst.y)) : (((src.y > 0.5) && (dst.y <= 0.25)) ? (dst.y + (2.0 * src.y - 1.0) * (4.0 * dst.y * (4.0 * dst.y + 1.0) * (dst.y - 1.0) + 7.0 * dst.y)) : (dst.y + (2.0 * src.y - 1.0) * (sqrt(dst.y) - dst.y))), (src.z <= 0.5) ? (dst.z - (1.0 - 2.0 * src.z) * dst.z * (1.0 - dst.z)) : (((src.z > 0.5) && (dst.z <= 0.25)) ? (dst.z + (2.0 * src.z - 1.0) * (4.0 * dst.z * (4.0 * dst.z + 1.0) * (dst.z - 1.0) + 7.0 * dst.z)) : (dst.z + (2.0 * src.z - 1.0) * (sqrt(dst.z) - dst.z))), 1.0);\n  if ( blendmode == 13 ) return vec4((src.x <= 0.5) ? (2.0 * src.x * dst.x) : (1.0 - 2.0 * (1.0 - src.x) * (1.0 - dst.x)), (src.y <= 0.5) ? (2.0 * src.y * dst.y) : (1.0 - 2.0 * (1.0 - src.y) * (1.0 - dst.y)), (src.z <= 0.5) ? (2.0 * src.z * dst.z) : (1.0 - 2.0 * (1.0 - src.z) * (1.0 - dst.z)), 1.0);\n  if ( blendmode == 14 ) return vec4((src.x <= 0.5) ? (1.0 - (1.0 - dst.x) / (2.0 * src.x)) : (dst.x / (2.0 * (1.0 - src.x))), (src.y <= 0.5) ? (1.0 - (1.0 - dst.y) / (2.0 * src.y)) : (dst.y / (2.0 * (1.0 - src.y))), (src.z <= 0.5) ? (1.0 - (1.0 - dst.z) / (2.0 * src.z)) : (dst.z / (2.0 * (1.0 - src.z))),1.0);\n  if ( blendmode == 15 ) return 2.0 * src + dst - 1.0;\n  if ( blendmode == 16 ) return vec4((src.x > 0.5) ? max(dst.x, 2.0 * (src.x - 0.5)) : min(dst.x, 2.0 * src.x), (src.x > 0.5) ? max(dst.y, 2.0 * (src.y - 0.5)) : min(dst.y, 2.0 * src.y), (src.z > 0.5) ? max(dst.z, 2.0 * (src.z - 0.5)) : min(dst.z, 2.0 * src.z),1.0);\n  if ( blendmode == 17 ) return abs(dst - src);\n  if ( blendmode == 18 ) return src + dst - 2.0 * src * dst;\n  return src + dst;\n}\n/* custom_helpers */\n")),e.fragmentShader=e.fragmentShader.replace("/* custom_main */","vec4 "+n.uuid+"_output = vec4( blend( "+d.uuid+"_output * "+n.uuid+"_alpha1, "+l.uuid+"_output * "+n.uuid+"_alpha2, "+n.uuid+"_blendmode ) );\n  /* custom_main */")};var m=(new Date).getTime(),p=0;n.update=function(){n.autoFade&&(c=a(),p=((new Date).getTime()-m)/1e3,n.pod(Math.sin(p*Math.PI*(c*i)/120)+1))},n.render=function(){return u},n.alpha1=function(){return r},n.alpha2=function(){return o},n.mixMode=function(e){return null!=e&&(s=e),s},n.blendMode=function(t){return null!=t&&(f=t,e.customUniforms[n.uuid+"_blendmode"].value=f),f},n.pod=function(t){return null!=t&&(u=t,1==s&&(r=u,o=1-u),2==s&&(r=Math.round(u),o=Math.round(1-u)),3==s&&((r=2*u)>1&&(r=1),(o=2-2*u)>1&&(o=1)),4==s&&(r=2*u,o=2-2*u),5==s&&((r=2*u)>1&&(r=1),(o=2-2*u)>1&&(o=1),r+=.36,o+=.36),6==s&&(r=1,o=0),7==s&&(r=0,o=1),8==s&&(r=.5,o=.5),9==s&&(r=1,o=1),10==s&&(r=u,o=1),11==s&&(r=1,o=u),e.customUniforms[n.uuid+"_alpha1"].value=r,e.customUniforms[n.uuid+"_alpha2"].value=o),u},n.bpm=function(e){return null!=e&&(c=e),c},n.bpmMod=function(e){return null!=e&&(i=e),i},n.bindBpm=function(e){a=e}}}function Output(e,t){this.uuid="Output_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),this.type="Module",e.add(this);var n=t;this.init=function(){e.fragmentShader=e.fragmentShader.replace("/* custom_main */","\n  gl_FragColor = vec4( "+n.uuid+"_output );\n")},this.update=function(){}}function Switcher(e,t){var n=this;n.uuid="Switcher_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),n.type="Module",e.add(n),n.sources=[t.source1,t.source2],n.active_source=0,n.init=function(){console.log("Switcher",n.uuid,n.sources),e.customUniforms[n.uuid+"_active_source"]={type:"i",value:1},e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform int "+n.uuid+"_active_source;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec4 "+n.uuid+"_output;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_helpers */","\nvec4 get_source_"+n.uuid+" ( int active_source, vec4 src1, vec4 src2 ) {\n  if ( active_source ==  0 ) return src1;  if ( active_source ==  1 ) return src2;}\n/* custom_helpers */\n"),e.fragmentShader=e.fragmentShader.replace("/* custom_main */","vec4 "+n.uuid+"_output = get_source_"+n.uuid+"("+n.uuid+"_active_source, "+n.sources[0].uuid+"_output, "+n.sources[1].uuid+"_output );\n  /* custom_main */")},n.update=function(){},n.render=function(){return n.sources[n.active_source]},n.doSwitch=function(t){return null==t?0==n.active_source?n.active_source=1:n.active_source=0:0!=t&&1!=t?console.log(n.uuid,t,"not allowed"):n.active_source=t,e.customUniforms[n.uuid+"_active_source"]={type:"i",value:n.active_source},n.active_source}}function Module(e,t){this.type="Module",this.init=function(){},this.update=function(){},this.render=function(){}}function GifSource(e,t){var n,r,o,u,c,i=this;null==t.uuid?i.uuid="GifSource_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):i.uuid=t.uuid,(i=this).type="GifSource",i.bypass=!0,e.add(i),null==t.src?i.currentSrc="/gif/a443ae90a963a657e12737c466ddff95.gif":i.currentSrc=t.src;i.init=function(){(n=document.createElement("canvas")).width=1024,n.height=1024,o=n.getContext("2d"),u=new THREE.Texture(n),e.customUniforms[i.uuid]={type:"t",value:u},e.customUniforms[i.uuid+"_alpha"]={type:"f",value:1},e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform sampler2D "+i.uuid+";\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec4 "+i.uuid+"_output;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform float "+i.uuid+"_alpha;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_main */","vec4 "+i.uuid+"_output = ( texture2D( "+i.uuid+", vUv ).rgba * "+i.uuid+"_alpha );\n  /* custom_main */"),i.gif=c,i.canvas=n,window.image_source=new Image,(r=document.createElement("img")).setAttribute("id","gif_"+i.uuid),r.setAttribute("rel:auto_play","1"),(c=new SuperGif({gif:r,c_w:"1024px",c_h:"576px"})).draw_while_loading=!0,console.log(i.uuid," Load",i.currentSrc,"..."),c.load_url(i.currentSrc,function(){console.log("play gif"),c.play()}),console.log("Gifsource Loaded First source!",i.currentSrc,"!"),i.bypass=!1},i.update=function(){try{o.clearRect(0,0,1024,1024),o.drawImage(c.get_canvas(),0,0,1024,1024),u&&(u.needsUpdate=!0)}catch(e){}},i.render=function(){return u},i.src=function(e){i.currentSrc=e,c.pause(),c.load_url(e,function(){console.log("play gif"),c.play()})},i.play=function(){return c.play()},i.pause=function(){return c.pause()},i.paused=function(){return!c.get_playing()},i.currentFrame=function(e){return void 0===e?c.get_current_frame():(c.move_to(e),e)},i.duration=function(){return c.get_length()}}function MultiVideoSource(e,t){var n,r,o,u=this;null==t.uuid?u.uuid="MultiVideoSource_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):u.uuid=t.uuid,u.type="MultiVideoSource",u.bypass=!0,e.add(u);u.init=function(){console.log("init video source",u.uuid),videoElement=document.createElement("video"),videoElement.setAttribute("crossorigin","anonymous"),videoElement.muted=!0,null==t.src?videoElement.src="//nabu-dev.s3.amazonaws.com/uploads/video/567498216465766873000000/720p_h264.mp4":videoElement.src=t.src,console.log("loaded source: ",videoElement.src),videoElement.height=1024,videoElement.width=1024,videoElement.loop=!0,videoElement.load(),u.firstplay=!1;var c=setInterval(function(){if(4==videoElement.readyState){var e=Math.random()*videoElement.duration;videoElement.currentTime=e,videoElement.play(),u.firstplay=!0,console.log(u.uuid,"First Play; ",e),clearInterval(c)}},400);document.body.addEventListener("click",function(){videoElement.play(),u.firstplay=!0}),videoElement.volume=0,(n=document.createElement("canvas")).width=1024,n.height=1024,r=n.getContext("2d"),o=new THREE.Texture(n),e.customUniforms[u.uuid]={type:"t",value:o},e.customUniforms[u.uuid+"_alpha"]={type:"f",value:1},e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform sampler2D "+u.uuid+";\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec4 "+u.uuid+"_output;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform float "+u.uuid+"_alpha;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_main */","vec4 "+u.uuid+"_output = ( texture2D( "+u.uuid+", vUv ).rgba * "+u.uuid+"_alpha );\n  /* custom_main */"),u.video=videoElement,u.canvas=n,u.bypass=!1},u.update=function(){(u.bypass=!1)||(videoElement.readyState!==videoElement.HAVE_ENOUGH_DATA||videoElement.seeking?(r.clearRect(0,0,1024,1024),u.alpha=0):(r.drawImage(videoElement,0,0,1024,1024),o&&(o.needsUpdate=!0)))},u.render=function(){return o},u.src=function(e){videoElement.src=e;var t=setInterval(function(){4==videoElement.readyState&&(videoElement.play(),console.log(u.uuid,"First Play."),clearInterval(t))},400)},u.play=function(){return videoElement.play()},u.pause=function(){return videoElement.pause()},u.paused=function(){return videoElement.paused},u.currentTime=function(e){return void 0===e?videoElement.currentTime:(console.log("set time",e),videoElement.currentTime=e,e)},u.duration=function(){return videoElement.duration},u.alpha=function(t){if(null==t)return e.customUniforms[u.uuid+"_alpha"].value;e.customUniforms[u.uuid+"_alpha"].value=t},u.jump=function(e){if(null==e||isNaN(e))try{videoElement.currentTime=Math.floor(Math.random()*u.duration())}catch(e){console.log("prevented a race error")}else videoElement.currentTime=e;return videoElement.currentTime}}function SVGSource(e,t){}function SolidSource(e,t){var n,r=this;null==t.uuid?r.uuid="SolidSource_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):r.uuid=t.uuid,r.bypass=!0,e.add(r);var o={r:0,g:0,b:0,a:1};null!=t&&(n=t),r.init=function(){console.log("init solid",n),null!=n.color&&(o=n.color),e.customUniforms[r.uuid+"_color"]={type:"v4",value:new THREE.Vector4(o.r,o.g,o.b,o.a)},e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec4 "+r.uuid+"_color;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec4 "+r.uuid+"_output;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_main */","vec4 "+r.uuid+"_output = "+r.uuid+"_color;\n  /* custom_main */")},r.update=function(){},r.render=function(){return o},r.color=function(t){return null!=t&&(null==(o=t).a&&(o.a=1),e.customUniforms[r.uuid+"_color"]={type:"v4",value:new THREE.Vector3(o.r,o.g,o.b,o.a)}),o},r.jump=function(e){console.log("no")}}function TextSource(e,t){var n,r,o,u,c=this;null==t.uuid?c.uuid="TextSource_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):c.uuid=t.uuid,c.type="TextSource",c.bypass=!0,e.add(c);c.init=function(){console.log("init text source",c.uuid),(r=document.createElement("DIV")).innerHTML="<h1> Awaiting text </h1>",r.height=1024,r.width=1024,c.firstplay=!1,n=document.createElement("canvas"),document.body.appendChild(n),n.width=1024,n.height=1024,o=n.getContext("2d"),u=new THREE.CanvasTexture(n),e.customUniforms[c.uuid]={type:"t",value:u},e.customUniforms[c.uuid+"_alpha"]={type:"f",value:1},e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform sampler2D "+c.uuid+";\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec4 "+c.uuid+"_output;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform float "+c.uuid+"_alpha;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_main */","vec4 "+c.uuid+"_output = ( texture2D( "+c.uuid+", vUv ).rgba * "+c.uuid+"_alpha );\n  /* custom_main */"),c.divElement=r,c.canvas=n,c.bypass=!1};var i=null;utils.get("/texts/fear_is_the_mind_killer.txt",function(e){i=e,console.log("get text",e)});var a=0,s="",d=0,l=12,f=600,m=300,p=64,h=512;c.update=function(){p*=.99,(c.bypass=!1)||null!=i&&(o.clearRect(0,0,n.width,n.height),o.fillStyle="rgba(60, 60, 60, 0.4)",o.font="604px IMPACT",o.textAlign="center",o.fillText(s.split(".").join(""),10*bpm.render()+m,f),o.fillStyle="white",o.font=p+"px IMPACT",o.textAlign="center",o.fillText(s.split(".").join(""),h,460),a>l&&(s=i.split(",")[d],l=i.split(",")[d].length*(bpm.bpm/72)+3,++d==i.split(",").length&&(d=0),a=0,f=Math.floor(200*Math.random())+600,m=Math.floor(200*Math.random())+200,h=Math.floor(100*Math.random())+470,p=Math.floor(30*Math.random())+70),a++,u&&(u.needsUpdate=!0))},c.render=function(){return u},c.alpha=function(t){if(null==t)return e.customUniforms[c.uuid+"_alpha"].value;e.customUniforms[c.uuid+"_alpha"].value=t}}function VideoSource(e,t){var n=this;null==t.uuid?n.uuid="VideoSource_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):n.uuid=t.uuid;var r,o,u,c;n.currentSrc="/video/placeholder.mp4",n.type="VideoSource",n.bypass=!0;e.add(n),n.init=function(){console.log("init video source",n.uuid),(o=document.createElement("video")).setAttribute("crossorigin","anonymous"),o.muted=!0,null==t.src?o.src=n.currentSrc:o.src=t.src,console.log("loaded source: ",o.src),o.height=1024,o.width=1024,o.loop=!0,o.load(),n.firstplay=!1;var i=setInterval(function(){if(4==o.readyState){var e=Math.random()*o.duration;o.currentTime=e,o.play(),n.firstplay=!0,console.log(n.uuid,"First Play; ",e),clearInterval(i)}},400);document.body.addEventListener("click",function(){o.play(),n.firstplay=!0}),o.volume=0,(r=document.createElement("canvas")).width=1024,r.height=1024,u=r.getContext("2d"),(c=new THREE.Texture(r)).wrapS=THREE.RepeatWrapping,c.wrapT=THREE.RepeatWrapping,e.customUniforms[n.uuid]={type:"t",value:c},e.customUniforms[n.uuid+"_alpha"]={type:"f",value:1},e.customUniforms[n.uuid+"_uvmap"]={type:"v2",value:new THREE.Vector2(0,0)},e.customUniforms[n.uuid+"_uvmap_mod"]={type:"v2",value:new THREE.Vector2(1,1)},e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform sampler2D "+n.uuid+";\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec4 "+n.uuid+"_output;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform float "+n.uuid+"_alpha;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec2 "+n.uuid+"_uvmap;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec2 "+n.uuid+"_uvmap_mod;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_main */","vec4 "+n.uuid+"_output = ( texture2D( "+n.uuid+", vUv + "+n.uuid+"_uvmap * vUv + "+n.uuid+"_uvmap_mod ).rgba * "+n.uuid+"_alpha );\n  /* custom_main */"),n.video=o,n.canvas=r,n.bypass=!1};n.update=function(){(n.bypass=!1)||(o.readyState!==o.HAVE_ENOUGH_DATA||o.seeking?(u.clearRect(0,0,1024,1024),n.alpha=0):(u.drawImage(o,0,0,1024,1024),c&&(c.needsUpdate=!0)))},n.render=function(){return c},n.src=function(e){try{n.currentSrc=e}catch(e){return void console.log("VideoSource returned empty promise, retrying ...")}o.src=e;var t=setInterval(function(){4==o.readyState&&(o.play(),console.log(n.uuid,"First Play."),clearInterval(t))},400)},n.play=function(){return o.play()},n.pause=function(){return o.pause()},n.paused=function(){return o.paused},n.currentTime=function(e){return void 0===e?o.currentTime:(console.log("set time",e),o.currentTime=e,e)},n.duration=function(){return o.duration},n.alpha=function(t){if(null==t)return e.customUniforms[n.uuid+"_alpha"].value;e.customUniforms[n.uuid+"_alpha"].value=t},n.jump=function(e){if(null==e||isNaN(e))try{o.currentTime=Math.floor(Math.random()*n.duration())}catch(e){console.log("prevented a race error")}else o.currentTime=e;return o.currentTime}}function WebcamSource(e,t){var n,r,o,u,c=this;null==t.uuid?c.uuid="WebcamSource_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):c.uuid=t.uuid,c.type="WebcamSource",c.bypass=!0,e.add(c);c.init=function(){console.log("init video source",c.uuid),(r=document.createElement("video")).setAttribute("crossorigin","anonymous"),r.height=1024,r.width=1024,r.loop=!0,r.load(),c.firstplay=!1;navigator.mediaDevices.getUserMedia({audio:!1,video:{width:1024,height:1024}}).then(function(e){r.srcObject=e,r.onloadedmetadata=function(e){r.play()}}).catch(function(e){console.log(e.name+": "+e.message)});var t=setInterval(function(){if(4==r.readyState){var e=Math.random()*r.duration;r.play(),c.firstplay=!0,console.log(c.uuid,"First Play; ",e),clearInterval(t)}},400);document.body.addEventListener("click",function(){r.play(),c.firstplay=!0}),r.volume=0,(n=document.createElement("canvas")).width=1024,n.height=1024,o=n.getContext("2d"),u=new THREE.Texture(n),e.customUniforms[c.uuid]={type:"t",value:u},e.customUniforms[c.uuid+"_alpha"]={type:"f",value:1},e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform sampler2D "+c.uuid+";\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec3 "+c.uuid+"_output;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform float "+c.uuid+"_alpha;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_main */","vec4 "+c.uuid+"_output = ( texture2D( "+c.uuid+", vUv ).rgba * "+c.uuid+"_alpha );\n  /* custom_main */"),c.video=r,c.canvas=n,c.bypass=!1},c.update=function(){(c.bypass=!1)||(r.readyState!==r.HAVE_ENOUGH_DATA||r.seeking?(o.clearRect(0,0,1024,1024),c.alpha=0):(o.drawImage(r,0,0,1024,1024),u&&(u.needsUpdate=!0)))},c.render=function(){return u},c.play=function(){return r.play()},c.pause=function(){return r.pause()},c.paused=function(){return r.paused},c.duration=function(){return r.duration},c.alpha=function(t){if(null==t)return e.customUniforms[c.uuid+"_alpha"].value;e.customUniforms[c.uuid+"_alpha"].value=t}}function Source(e,t){this.type="Source",this.function_list=[["JUMP","method","jump"]],this.init=function(){},this.update=function(){},this.render=function(){},this.start=function(){},this.src=function(e){},this.play=function(){},this.pause=function(){},this.paused=function(){},this.currentFrame=function(e){},this.duration=function(){},this.jump=function(){}}AudioAnalysis.prototype=new Addon,AudioAnalysis.constructor=AudioAnalysis,BPM.prototype=new Addon,BPM.constructor=BPM,FileManager.prototype=new Addon,FileManager.constructor=FileManager,GiphyManager.prototype=new Addon,GiphyManager.constructor=GiphyManager,ComputerKeyboard.prototype=new Controller,ComputerKeyboard.constructor=ComputerKeyboard,Gamepad.prototype=new Controller,Gamepad.constructor=Gamepad,GamePadController.prototype=new Controller,GamePadController.constructor=GamePadController,MidiController.prototype=new Controller,MidiController.constructor=MidiController,NumpadBpmMixerControl.prototype=new ComputerKeyboard,NumpadBpmMixerControl.constructor=NumpadBpmMixerControl,ColorEffect.prototype=new Effect,ColorEffect.constructor=ColorEffect,DistortionEffect.prototype=new Effect,DistortionEffect.constructor=DistortionEffect,FeedbackEffect.prototype=new Effect,FeedbackEffect.constructor=FeedbackEffect,GifSource.prototype=new Source,GifSource.constructor=GifSource,MultiVideoSource.prototype=new Source,MultiVideoSource.constructor=MultiVideoSource,SVGSource.prototype=new Source,SVGSource.constructor=SVGSource,SolidSource.prototype=new Source,SolidSource.constructor=SolidSource,TextSource.prototype=new Source,TextSource.constructor=TextSource,VideoSource.prototype=new Source,VideoSource.constructor=VideoSource,WebcamSource.prototype=new Source,WebcamSource.constructor=WebcamSource;